"use strict";var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,i=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),a=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,c=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&a(e,n,t[n]);if(r)for(var n of r(t))s.call(t,n)&&a(e,n,t[n]);return e},u=(e,r)=>t(e,n(r)),l=(e,t)=>{var n={};for(var i in e)o.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&r)for(var i of r(e))t.indexOf(i)<0&&s.call(e,i)&&(n[i]=e[i]);return n},p=(e,t,n)=>new Promise(((r,o)=>{var s=e=>{try{a(n.next(e))}catch(t){o(t)}},i=e=>{try{a(n.throw(e))}catch(t){o(t)}},a=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,i);a((n=n.apply(e,t)).next())})),d=function(e,t){this[0]=e,this[1]=t},f=(e,t,n)=>{var r=(e,t,o,s)=>{try{var i=n[e](t),a=(t=i.value)instanceof d,c=i.done;Promise.resolve(a?t[0]:t).then((n=>a?r("return"===e?e:"next",t[1]?{done:n.done,value:n.value}:n,o,s):o({value:n,done:c}))).catch((e=>r("throw",e,o,s)))}catch(u){s(u)}},o=e=>s[e]=t=>new Promise(((n,o)=>r(e,t,n,o))),s={};return n=n.apply(e,t),s[i("asyncIterator")]=()=>s,o("next"),o("throw"),o("return"),s},m=(e,t,n)=>(t=e[i("asyncIterator")])?t.call(e):(e=e[i("iterator")](),t={},(n=(n,r)=>(r=e[n])&&(t[n]=t=>new Promise(((n,o,s)=>(t=r.call(e,t),s=t.done,Promise.resolve(t.value).then((e=>n({value:e,done:s})),o))))))("next"),n("return"),t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),"object"!=typeof globalThis&&(Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__);const g=function(){const e=Function("return this")();return e&&void 0!==e.wx&&e.wx?e.wx:e&&void 0!==e.my&&e.my?e.my:e&&void 0!==e.swan&&e.swan?e.swan:e&&void 0!==e.tt&&e.tt?e.tt:e&&void 0!==e.qq&&e.qq?e.qq:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:e}();class h{constructor(e){if(this._entries=[],e)if("string"!=typeof e)Array.isArray(e)?e.forEach((([e,t])=>this.append(e,t))):Object.keys(e).forEach((t=>{const n=e[t];null!=n&&this.append(t,String(n))}));else{const t=e.startsWith("?")?e.slice(1):e;t.length>0&&t.split("&").forEach((e=>{if(!e)return;const[t,n=""]=e.split("=");this.append(decodeURIComponent(t),decodeURIComponent(n))}))}}append(e,t){this._entries.push([e,t])}toString(){return this._entries.map((([e,t])=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`)).join("&")}}g.URLSearchParams||(g.URLSearchParams=h);const _="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,y=globalThis,v="10.27.0";function b(){return S(y),y}function S(e){const t=e.__SENTRY__=e.__SENTRY__||{};return t.version=t.version||v,t[v]=t[v]||{}}function x(e,t,n=y){const r=n.__SENTRY__=n.__SENTRY__||{},o=r[v]=r[v]||{};return o[e]||(o[e]=t())}const k=["debug","info","warn","error","log","assert","trace"],w={};function E(e){if(!("console"in y))return e();const t=y.console,n={},r=Object.keys(w);r.forEach((e=>{const r=w[e];n[e]=t[e],t[e]=r}));try{return e()}finally{r.forEach((e=>{t[e]=n[e]}))}}function T(){return A().enabled}function I(e,...t){_&&T()&&E((()=>{y.console[e](`Sentry Logger [${e}]:`,...t)}))}function A(){return _?x("loggerSettings",(()=>({enabled:!1}))):{enabled:!1}}const O={enable:function(){A().enabled=!0},disable:function(){A().enabled=!1},isEnabled:T,log:function(...e){I("log",...e)},warn:function(...e){I("warn",...e)},error:function(...e){I("error",...e)}},C="<anonymous>";function $(e){try{return e&&"function"==typeof e&&e.name||C}catch(t){return C}}function M(e){return"__v_isVNode"in e&&e.__v_isVNode?"[VueVNode]":"[VueViewModel]"}const P={},R={};function j(e,t){P[e]=P[e]||[],P[e].push(t)}function N(e,t){if(!R[e]){R[e]=!0;try{t()}catch(n){_&&O.error(`Error while instrumenting ${e}`,n)}}}function D(e,t){const n=e&&P[e];if(n)for(const o of n)try{o(t)}catch(r){_&&O.error(`Error while triggering instrumentation handler.\nType: ${e}\nName: ${$(o)}\nError:`,r)}}let L=null;function F(){L=y.onerror,y.onerror=function(e,t,n,r,o){return D("error",{column:r,error:o,line:n,msg:e,url:t}),!!L&&L.apply(this,arguments)},y.onerror.__SENTRY_INSTRUMENTED__=!0}let q=null;function U(){q=y.onunhandledrejection,y.onunhandledrejection=function(e){return D("unhandledrejection",e),!q||q.apply(this,arguments)},y.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}const B=Object.prototype.toString;function J(e){switch(B.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return Q(e,Error)}}function z(e,t){return B.call(e)===`[object ${t}]`}function W(e){return z(e,"ErrorEvent")}function H(e){return z(e,"DOMError")}function G(e){return z(e,"String")}function K(e){return"object"==typeof e&&null!==e&&"__sentry_template_string__"in e&&"__sentry_template_values__"in e}function V(e){return null===e||K(e)||"object"!=typeof e&&"function"!=typeof e}function Y(e){return z(e,"Object")}function Z(e){return"undefined"!=typeof Event&&Q(e,Event)}function X(e){return Boolean((null==e?void 0:e.then)&&"function"==typeof e.then)}function Q(e,t){try{return e instanceof t}catch(n){return!1}}function ee(e){return!("object"!=typeof e||null===e||!(e.__isVue||e._isVue||e.__v_isVNode))}const te=y;function ne(e,t){const n=e,r=[];if(!(null==n?void 0:n.tagName))return"";if(te.HTMLElement&&n instanceof HTMLElement&&n.dataset){if(n.dataset.sentryComponent)return n.dataset.sentryComponent;if(n.dataset.sentryElement)return n.dataset.sentryElement}r.push(n.tagName.toLowerCase());const o=(null==t?void 0:t.length)?t.filter((e=>n.getAttribute(e))).map((e=>[e,n.getAttribute(e)])):null;if(null==o?void 0:o.length)o.forEach((e=>{r.push(`[${e[0]}="${e[1]}"]`)}));else{n.id&&r.push(`#${n.id}`);const e=n.className;if(e&&G(e)){const t=e.split(/\s+/);for(const e of t)r.push(`.${e}`)}}const s=["aria-label","type","name","title","alt"];for(const i of s){const e=n.getAttribute(i);e&&r.push(`[${i}="${e}"]`)}return r.join("")}function re(e,t,n){if(!(t in e))return;const r=e[t];if("function"!=typeof r)return;const o=n(r);"function"==typeof o&&se(o,r);try{e[t]=o}catch(s){_&&O.log(`Failed to replace method "${t}" in object`,e)}}function oe(e,t,n){try{Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})}catch(r){_&&O.log(`Failed to add non-enumerable property "${t}" to object`,e)}}function se(e,t){try{const n=t.prototype||{};e.prototype=t.prototype=n,oe(e,"__sentry_original__",t)}catch(n){}}function ie(e){return e.__sentry_original__}function ae(e){if(J(e))return c({message:e.message,name:e.name,stack:e.stack},ue(e));if(Z(e)){const t=c({type:e.type,target:ce(e.target),currentTarget:ce(e.currentTarget)},ue(e));return"undefined"!=typeof CustomEvent&&Q(e,CustomEvent)&&(t.detail=e.detail),t}return e}function ce(e){try{return t=e,"undefined"!=typeof Element&&Q(t,Element)?function(e,t={}){if(!e)return"<unknown>";try{let n=e;const r=5,o=[];let s=0,i=0;const a=" > ",c=a.length;let u;const l=Array.isArray(t)?t:t.keyAttrs,p=!Array.isArray(t)&&t.maxStringLength||80;for(;n&&s++<r&&(u=ne(n,l),!("html"===u||s>1&&i+o.length*c+u.length>=p));)o.push(u),i+=u.length,n=n.parentNode;return o.reverse().join(a)}catch(n){return"<unknown>"}}(e):Object.prototype.toString.call(e)}catch(n){return"<unknown>"}var t}function ue(e){if("object"==typeof e&&null!==e){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}return{}}function le(e,t=0){return"string"!=typeof e||0===t||e.length<=t?e:`${e.slice(0,t)}...`}function pe(e,t){if(!Array.isArray(e))return"";const n=[];for(let o=0;o<e.length;o++){const t=e[o];try{ee(t)?n.push(M(t)):n.push(String(t))}catch(r){n.push("[value cannot be serialized]")}}return n.join(t)}function de(e,t,n=!1){return!!G(e)&&(z(t,"RegExp")?t.test(e):!!G(t)&&(n?e===t:e.includes(t)))}function fe(e,t=[],n=!1){return t.some((t=>de(e,t,n)))}let me;function ge(e=function(){const e=y;return e.crypto||e.msCrypto}()){try{if(null==e?void 0:e.randomUUID)return e.randomUUID().replace(/-/g,"")}catch(t){}return me||(me="10000000100040008000100000000000"),me.replace(/[018]/g,(e=>(e^(16*Math.random()&15)>>e/4).toString(16)))}function he(e){var t,n;return null==(n=null==(t=e.exception)?void 0:t.values)?void 0:n[0]}function _e(e){const{message:t,event_id:n}=e;if(t)return t;const r=he(e);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function ye(e,t,n){const r=e.exception=e.exception||{},o=r.values=r.values||[],s=o[0]=o[0]||{};s.value||(s.value=t||""),s.type||(s.type="Error")}function ve(e,t){const n=he(e);if(!n)return;const r=n.mechanism;if(n.mechanism=c(c(c({},{type:"generic",handled:!0}),r),t),t&&"data"in t){const e=c(c({},null==r?void 0:r.data),t.data);n.mechanism.data=e}}function be(e){if(function(e){try{return e.__sentry_captured__}catch(t){}}(e))return!0;try{oe(e,"__sentry_captured__",!0)}catch(t){}return!1}function Se(){return Date.now()/1e3}let xe;function ke(){return(null!=xe?xe:xe=function(){const{performance:e}=y;if(!(null==e?void 0:e.now)||!e.timeOrigin)return Se;const t=e.timeOrigin;return()=>(t+e.now())/1e3}())()}function we(e,t={}){if(t.user&&(!e.ipAddress&&t.user.ip_address&&(e.ipAddress=t.user.ip_address),e.did||t.did||(e.did=t.user.id||t.user.email||t.user.username)),e.timestamp=t.timestamp||ke(),t.abnormal_mechanism&&(e.abnormal_mechanism=t.abnormal_mechanism),t.ignoreDuration&&(e.ignoreDuration=t.ignoreDuration),t.sid&&(e.sid=32===t.sid.length?t.sid:ge()),void 0!==t.init&&(e.init=t.init),!e.did&&t.did&&(e.did=`${t.did}`),"number"==typeof t.started&&(e.started=t.started),e.ignoreDuration)e.duration=void 0;else if("number"==typeof t.duration)e.duration=t.duration;else{const t=e.timestamp-e.started;e.duration=t>=0?t:0}t.release&&(e.release=t.release),t.environment&&(e.environment=t.environment),!e.ipAddress&&t.ipAddress&&(e.ipAddress=t.ipAddress),!e.userAgent&&t.userAgent&&(e.userAgent=t.userAgent),"number"==typeof t.errors&&(e.errors=t.errors),t.status&&(e.status=t.status)}function Ee(e,t,n=2){if(!t||"object"!=typeof t||n<=0)return t;if(e&&0===Object.keys(t).length)return e;const r=c({},e);for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=Ee(r[o],t[o],n-1));return r}function Te(){return ge()}function Ie(){return ge().substring(16)}const Ae="_sentrySpan";function Oe(e,t){t?oe(e,Ae,t):delete e[Ae]}function Ce(e){return e[Ae]}class $e{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._attributes={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:Te(),sampleRand:Math.random()}}clone(){const e=new $e;return e._breadcrumbs=[...this._breadcrumbs],e._tags=c({},this._tags),e._attributes=c({},this._attributes),e._extra=c({},this._extra),e._contexts=c({},this._contexts),this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._attachments=[...this._attachments],e._sdkProcessingMetadata=c({},this._sdkProcessingMetadata),e._propagationContext=c({},this._propagationContext),e._client=this._client,e._lastEventId=this._lastEventId,Oe(e,Ce(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&we(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}setTags(e){return this._tags=c(c({},this._tags),e),this._notifyScopeListeners(),this}setTag(e,t){return this.setTags({[e]:t})}setAttributes(e){return this._attributes=c(c({},this._attributes),e),this._notifyScopeListeners(),this}setAttribute(e,t){return this.setAttributes({[e]:t})}removeAttribute(e){return e in this._attributes&&(delete this._attributes[e],this._notifyScopeListeners()),this}setExtras(e){return this._extra=c(c({},this._extra),e),this._notifyScopeListeners(),this}setExtra(e,t){return this._extra=u(c({},this._extra),{[e]:t}),this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,t){return null===t?delete this._contexts[e]:this._contexts[e]=t,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const t="function"==typeof e?e(this):e,n=t instanceof $e?t.getScopeData():Y(t)?e:void 0,{tags:r,attributes:o,extra:s,user:i,contexts:a,level:u,fingerprint:l=[],propagationContext:p}=n||{};return this._tags=c(c({},this._tags),r),this._attributes=c(c({},this._attributes),o),this._extra=c(c({},this._extra),s),this._contexts=c(c({},this._contexts),a),i&&Object.keys(i).length&&(this._user=i),u&&(this._level=u),l.length&&(this._fingerprint=l),p&&(this._propagationContext=p),this}clear(){return this._breadcrumbs=[],this._tags={},this._attributes={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._session=void 0,Oe(this,void 0),this._attachments=[],this.setPropagationContext({traceId:Te(),sampleRand:Math.random()}),this._notifyScopeListeners(),this}addBreadcrumb(e,t){var n;const r="number"==typeof t?t:100;if(r<=0)return this;const o=u(c({timestamp:Se()},e),{message:e.message?le(e.message,2048):e.message});return this._breadcrumbs.push(o),this._breadcrumbs.length>r&&(this._breadcrumbs=this._breadcrumbs.slice(-r),null==(n=this._client)||n.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,attributes:this._attributes,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:Ce(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=Ee(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext=e,this}getPropagationContext(){return this._propagationContext}captureException(e,t){const n=(null==t?void 0:t.event_id)||ge();if(!this._client)return _&&O.warn("No client configured on scope - will not capture exception!"),n;const r=new Error("Sentry syntheticException");return this._client.captureException(e,u(c({originalException:e,syntheticException:r},t),{event_id:n}),this),n}captureMessage(e,t,n){var r;const o=(null==n?void 0:n.event_id)||ge();if(!this._client)return _&&O.warn("No client configured on scope - will not capture message!"),o;const s=null!=(r=null==n?void 0:n.syntheticException)?r:new Error(e);return this._client.captureMessage(e,t,u(c({originalException:e,syntheticException:s},n),{event_id:o}),this),o}captureEvent(e,t){const n=(null==t?void 0:t.event_id)||ge();return this._client?(this._client.captureEvent(e,u(c({},t),{event_id:n}),this),n):(_&&O.warn("No client configured on scope - will not capture event!"),n)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach((e=>{e(this)})),this._notifyingListeners=!1)}}class Me{constructor(e,t){let n,r;n=e||new $e,r=t||new $e,this._stack=[{scope:n}],this._isolationScope=r}withScope(e){const t=this._pushScope();let n;try{n=e(t)}catch(r){throw this._popScope(),r}return X(n)?n.then((e=>(this._popScope(),e)),(e=>{throw this._popScope(),e})):(this._popScope(),n)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return!(this._stack.length<=1)&&!!this._stack.pop()}}function Pe(){const e=S(b());return e.stack=e.stack||new Me(x("defaultCurrentScope",(()=>new $e)),x("defaultIsolationScope",(()=>new $e)))}function Re(e){return Pe().withScope(e)}function je(e,t){const n=Pe();return n.withScope((()=>(n.getStackTop().scope=e,t(e))))}function Ne(e){return Pe().withScope((()=>e(Pe().getIsolationScope())))}function De(e){const t=S(e);return t.acs?t.acs:{withIsolationScope:Ne,withScope:Re,withSetScope:je,withSetIsolationScope:(e,t)=>Ne(t),getCurrentScope:()=>Pe().getScope(),getIsolationScope:()=>Pe().getIsolationScope()}}function Le(){return De(b()).getCurrentScope()}function Fe(){return De(b()).getIsolationScope()}function qe(){return x("globalScope",(()=>new $e))}function Ue(...e){const t=De(b());if(2===e.length){const[n,r]=e;return n?t.withSetScope(n,r):t.withScope(r)}return t.withScope(e[0])}function Be(){return Le().getClient()}function Je(e){const t=e.getPropagationContext(),{traceId:n,parentSpanId:r,propagationSpanId:o}=t,s={trace_id:n,span_id:o||Ie()};return r&&(s.parent_span_id=r),s}const ze="sentry.source",We="sentry.sample_rate",He="sentry.op",Ge="sentry.origin",Ke="sentry.idle_span_finish_reason",Ve="sentry.measurement_unit",Ye="sentry.measurement_value",Ze="sentry.custom_span_name",Xe="sentry.profile_id",Qe="sentry.exclusive_time";function et(e){if(e<400&&e>=100)return{code:1};if(e>=400&&e<500)switch(e){case 401:return{code:2,message:"unauthenticated"};case 403:return{code:2,message:"permission_denied"};case 404:return{code:2,message:"not_found"};case 409:return{code:2,message:"already_exists"};case 413:return{code:2,message:"failed_precondition"};case 429:return{code:2,message:"resource_exhausted"};case 499:return{code:2,message:"cancelled"};default:return{code:2,message:"invalid_argument"}}if(e>=500&&e<600)switch(e){case 501:return{code:2,message:"unimplemented"};case 503:return{code:2,message:"unavailable"};case 504:return{code:2,message:"deadline_exceeded"};default:return{code:2,message:"internal_error"}}return{code:2,message:"internal_error"}}function nt(e,t){e.setAttribute("http.response.status_code",t);const n=et(t);"unknown_error"!==n.message&&e.setStatus(n)}const rt="_sentryScope",ot="_sentryIsolationScope";function st(e){if(e){if("object"==typeof e&&"deref"in e&&"function"==typeof e.deref)try{return e.deref()}catch(t){return}return e}}function it(e,t,n){e&&(oe(e,ot,function(e){try{const t=y.WeakRef;if("function"==typeof t)return new t(e)}catch(t){}return e}(n)),oe(e,rt,t))}function at(e){const t=e;return{scope:t[rt],isolationScope:st(t[ot])}}const ct=/^sentry-/;function ut(e){const t=function(e){if(!e||!G(e)&&!Array.isArray(e))return;if(Array.isArray(e))return e.reduce(((e,t)=>{const n=lt(t);return Object.entries(n).forEach((([t,n])=>{e[t]=n})),e}),{});return lt(e)}(e);if(!t)return;const n=Object.entries(t).reduce(((e,[t,n])=>{if(t.match(ct)){e[t.slice(7)]=n}return e}),{});return Object.keys(n).length>0?n:void 0}function lt(e){return e.split(",").map((e=>{const t=e.indexOf("=");if(-1===t)return[];return[e.slice(0,t),e.slice(t+1)].map((e=>{try{return decodeURIComponent(e.trim())}catch(t){return}}))})).reduce(((e,[t,n])=>(t&&n&&(e[t]=n),e)),{})}const pt=/^o(\d+)\./,dt=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function ft(e,t=!1){const{host:n,path:r,pass:o,port:s,projectId:i,protocol:a,publicKey:c}=e;return`${a}://${c}${t&&o?`:${o}`:""}@${n}${s?`:${s}`:""}/${r?`${r}/`:r}${i}`}function mt(e){const t=dt.exec(e);if(!t)return void E((()=>{console.error(`Invalid Sentry Dsn: ${e}`)}));const[n,r,o="",s="",i="",a=""]=t.slice(1);let c="",u=a;const l=u.split("/");if(l.length>1&&(c=l.slice(0,-1).join("/"),u=l.pop()),u){const e=u.match(/^\d+/);e&&(u=e[0])}return gt({host:s,pass:o,path:c,projectId:u,port:i,protocol:n,publicKey:r})}function gt(e){return{protocol:e.protocol,publicKey:e.publicKey||"",pass:e.pass||"",host:e.host,port:e.port||"",path:e.path||"",projectId:e.projectId}}function ht(e){const t=e.getOptions(),{host:n}=e.getDsn()||{};let r;return t.orgId?r=String(t.orgId):n&&(r=function(e){const t=e.match(pt);return null==t?void 0:t[1]}(n)),r}function _t(e){const t="string"==typeof e?mt(e):gt(e);if(t&&function(e){if(!_)return!0;const{port:t,projectId:n,protocol:r}=e;return!(["protocol","publicKey","host","projectId"].find((t=>!e[t]&&(O.error(`Invalid Sentry Dsn: ${t} missing`),!0)))||(n.match(/^\d+$/)?function(e){return"http"===e||"https"===e}(r)?t&&isNaN(parseInt(t,10))&&(O.error(`Invalid Sentry Dsn: Invalid port ${t}`),1):(O.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),1):(O.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),1)))}(t))return t}function yt(e){if("boolean"==typeof e)return Number(e);const t="string"==typeof e?parseFloat(e):e;return"number"!=typeof t||isNaN(t)||t<0||t>1?void 0:t}let vt=!1;function bt(e){const{spanId:t,traceId:n}=e.spanContext(),{data:r,op:o,parent_span_id:s,status:i,origin:a,links:c}=Et(e);return{parent_span_id:s,span_id:t,trace_id:n,data:r,op:o,status:i,origin:a,links:c}}function St(e){const{spanId:t,traceId:n,isRemote:r}=e.spanContext(),o=r?t:Et(e).parent_span_id,s=at(e).scope;return{parent_span_id:o,span_id:r?(null==s?void 0:s.getPropagationContext().propagationSpanId)||Ie():t,trace_id:n}}function xt(e){return e&&e.length>0?e.map((e=>{var t=e,{context:n}=t,r=n,{spanId:o,traceId:s,traceFlags:i}=r,a=l(r,["spanId","traceId","traceFlags"]),{attributes:u}=t;return c({span_id:o,trace_id:s,sampled:1===i,attributes:u},a)})):void 0}function kt(e){return"number"==typeof e?wt(e):Array.isArray(e)?e[0]+e[1]/1e9:e instanceof Date?wt(e.getTime()):ke()}function wt(e){return e>9999999999?e/1e3:e}function Et(e){var t;if(function(e){return"function"==typeof e.getSpanJSON}(e))return e.getSpanJSON();const{spanId:n,traceId:r}=e.spanContext();if(function(e){const t=e;return!!(t.attributes&&t.startTime&&t.name&&t.endTime&&t.status)}(e)){const{attributes:o,startTime:s,name:i,endTime:a,status:c,links:u}=e;return{span_id:n,trace_id:r,data:o,description:i,parent_span_id:"parentSpanId"in e?e.parentSpanId:"parentSpanContext"in e?null==(t=e.parentSpanContext)?void 0:t.spanId:void 0,start_timestamp:kt(s),timestamp:kt(a)||void 0,status:It(c),op:o[He],origin:o[Ge],links:xt(u)}}return{span_id:n,trace_id:r,start_timestamp:0,data:{}}}function Tt(e){const{traceFlags:t}=e.spanContext();return 1===t}function It(e){if(e&&0!==e.code)return 1===e.code?"ok":e.message||"internal_error"}const At="_sentryChildSpans",Ot="_sentryRootSpan";function Ct(e,t){const n=e[Ot]||e;oe(t,Ot,n),e[At]?e[At].add(t):oe(e,At,new Set([t]))}function $t(e){const t=new Set;return function e(n){if(!t.has(n)&&Tt(n)){t.add(n);const r=n[At]?Array.from(n[At]):[];for(const t of r)e(t)}}(e),Array.from(t)}function Mt(e){return e[Ot]||e}function Pt(){const e=De(b());return e.getActiveSpan?e.getActiveSpan():Ce(Le())}function Rt(){vt||(E((()=>{console.warn("[Sentry] Returning null from `beforeSendSpan` is disallowed. To drop certain spans, configure the respective integrations directly or use `ignoreSpans`.")})),vt=!0)}let jt=!1;function Nt(e){var t;if("boolean"==typeof __SENTRY_TRACING__&&!__SENTRY_TRACING__)return!1;const n=e||(null==(t=Be())?void 0:t.getOptions());return!(!n||null==n.tracesSampleRate&&!n.tracesSampler)}function Dt(e){O.log(`Ignoring span ${e.op} - ${e.description} because it matches \`ignoreSpans\`.`)}function Lt(e,t){if(!(null==t?void 0:t.length)||!e.description)return!1;for(const r of t){if("string"==typeof(n=r)||n instanceof RegExp){if(de(e.description,r))return _&&Dt(e),!0;continue}if(!r.name&&!r.op)continue;const t=!r.name||de(e.description,r.name),o=!r.op||e.op&&de(e.op,r.op);if(t&&o)return _&&Dt(e),!0}var n;return!1}function Ft(e,t){const n=t.parent_span_id,r=t.span_id;if(n)for(const o of e)o.parent_span_id===r&&(o.parent_span_id=n)}const qt="production",Ut="_frozenDsc";function Bt(e,t){oe(e,Ut,t)}function Jt(e,t){const n=t.getOptions(),{publicKey:r}=t.getDsn()||{},o={environment:n.environment||qt,release:n.release,public_key:r,trace_id:e,org_id:ht(t)};return t.emit("createDsc",o),o}function zt(e,t){const n=t.getPropagationContext();return n.dsc||Jt(n.traceId,e)}function Wt(e){var t,n,r,o;const s=Be();if(!s)return{};const i=Mt(e),a=Et(i),c=a.data,u=i.spanContext().traceState,l=null!=(n=null!=(t=null==u?void 0:u.get("sentry.sample_rate"))?t:c[We])?n:c["sentry.previous_trace_sample_rate"];function p(e){return"number"!=typeof l&&"string"!=typeof l||(e.sample_rate=`${l}`),e}const d=i[Ut];if(d)return p(d);const f=null==u?void 0:u.get("sentry.dsc"),m=f&&ut(f);if(m)return p(m);const g=Jt(e.spanContext().traceId,s),h=c[ze],_=a.description;return"url"!==h&&_&&(g.transaction=_),Nt()&&(g.sampled=String(Tt(i)),g.sample_rand=null!=(o=null==u?void 0:u.get("sentry.sample_rand"))?o:null==(r=at(i).scope)?void 0:r.getPropagationContext().sampleRand.toString()),p(g),s.emit("createDsc",g,i),g}class Ht{constructor(e={}){this._traceId=e.traceId||Te(),this._spanId=e.spanId||Ie()}spanContext(){return{spanId:this._spanId,traceId:this._traceId,traceFlags:0}}end(e){}setAttribute(e,t){return this}setAttributes(e){return this}setStatus(e){return this}updateName(e){return this}isRecording(){return!1}addEvent(e,t,n){return this}addLink(e){return this}addLinks(e){return this}recordException(e,t){}}function Gt(e,t=100,n=1/0){try{return Vt("",e,t,n)}catch(r){return{ERROR:`**non-serializable** (${r})`}}}function Kt(e,t=3,n=102400){const r=Gt(e,t);return o=r,function(e){return~-encodeURI(e).split(/%..|./).length}(JSON.stringify(o))>n?Kt(e,t-1,n):r;var o}function Vt(e,t,n=1/0,r=1/0,o=function(){const e=new WeakSet;function t(t){return!!e.has(t)||(e.add(t),!1)}function n(t){e.delete(t)}return[t,n]}()){const[s,i]=o;if(null==t||["boolean","string"].includes(typeof t)||"number"==typeof t&&Number.isFinite(t))return t;const a=function(e,t){try{if("domain"===e&&t&&"object"==typeof t&&t._events)return"[Domain]";if("domainEmitter"===e)return"[DomainEmitter]";if("undefined"!=typeof global&&t===global)return"[Global]";if("undefined"!=typeof window&&t===window)return"[Window]";if("undefined"!=typeof document&&t===document)return"[Document]";if(ee(t))return M(t);if(Y(n=t)&&"nativeEvent"in n&&"preventDefault"in n&&"stopPropagation"in n)return"[SyntheticEvent]";if("number"==typeof t&&!Number.isFinite(t))return`[${t}]`;if("function"==typeof t)return`[Function: ${$(t)}]`;if("symbol"==typeof t)return`[${String(t)}]`;if("bigint"==typeof t)return`[BigInt: ${String(t)}]`;const r=function(e){const t=Object.getPrototypeOf(e);return(null==t?void 0:t.constructor)?t.constructor.name:"null prototype"}(t);return/^HTML(\w*)Element$/.test(r)?`[HTMLElement: ${r}]`:`[object ${r}]`}catch(r){return`**non-serializable** (${r})`}var n}(e,t);if(!a.startsWith("[object "))return a;if(t.__sentry_skip_normalization__)return t;const c="number"==typeof t.__sentry_override_normalization_depth__?t.__sentry_override_normalization_depth__:n;if(0===c)return a.replace("object ","");if(s(t))return"[Circular ~]";const u=t;if(u&&"function"==typeof u.toJSON)try{return Vt("",u.toJSON(),c-1,r,o)}catch(f){}const l=Array.isArray(t)?[]:{};let p=0;const d=ae(t);for(const m in d){if(!Object.prototype.hasOwnProperty.call(d,m))continue;if(p>=r){l[m]="[MaxProperties ~]";break}const e=d[m];l[m]=Vt(m,e,c-1,r,o),p++}return i(t),l}function Yt(e,t=[]){return[e,t]}function Zt(e,t){const[n,r]=e;return[n,[...r,t]]}function Xt(e,t){const n=e[1];for(const r of n){if(t(r,r[0].type))return!0}return!1}function Qt(e){const t=S(y);return t.encodePolyfill?t.encodePolyfill(e):(new TextEncoder).encode(e)}function en(e){const[t,n]=e;let r=JSON.stringify(t);function o(e){"string"==typeof r?r="string"==typeof e?r+e:[Qt(r),e]:r.push("string"==typeof e?Qt(e):e)}for(const i of n){const[e,t]=i;if(o(`\n${JSON.stringify(e)}\n`),"string"==typeof t||t instanceof Uint8Array)o(t);else{let e;try{e=JSON.stringify(t)}catch(s){e=JSON.stringify(Gt(t))}o(e)}}return"string"==typeof r?r:function(e){const t=e.reduce(((e,t)=>e+t.length),0),n=new Uint8Array(t);let r=0;for(const o of e)n.set(o,r),r+=o.length;return n}(r)}function tn(e){return[{type:"span"},e]}function nn(e){const t="string"==typeof e.data?Qt(e.data):e.data;return[{type:"attachment",length:t.length,filename:e.filename,content_type:e.contentType,attachment_type:e.attachmentType},t]}const rn={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",raw_security:"security",log:"log_item",metric:"metric",trace_metric:"metric"};function on(e){return rn[e]}function sn(e){if(!(null==e?void 0:e.sdk))return;const{name:t,version:n}=e.sdk;return{name:t,version:n}}function an(e,t,n,r){const o=sn(n),s=e.type&&"replay_event"!==e.type?e.type:"event";!function(e,t){var n,r,o,s;if(!t)return e;const i=e.sdk||{};e.sdk=u(c({},i),{name:i.name||t.name,version:i.version||t.version,integrations:[...(null==(n=e.sdk)?void 0:n.integrations)||[],...t.integrations||[]],packages:[...(null==(r=e.sdk)?void 0:r.packages)||[],...t.packages||[]],settings:(null==(o=e.sdk)?void 0:o.settings)||t.settings?c(c({},null==(s=e.sdk)?void 0:s.settings),t.settings):void 0})}(e,null==n?void 0:n.sdk);const i=function(e,t,n,r){var o;const s=null==(o=e.sdkProcessingMetadata)?void 0:o.dynamicSamplingContext;return c(c(c({event_id:e.event_id,sent_at:(new Date).toISOString()},t&&{sdk:t}),!!n&&r&&{dsn:ft(r)}),s&&{trace:s})}(e,o,r,t);delete e.sdkProcessingMetadata;return Yt(i,[[{type:s},e]])}function cn(e,t,n,r=Pt()){const o=r&&Mt(r);o&&(_&&O.log(`[Measurement] Setting measurement on root span: ${e} = ${t} ${n}`),o.addEvent(e,{[Ye]:t,[Ve]:n}))}function un(e){if(!e||0===e.length)return;const t={};return e.forEach((e=>{const n=e.attributes||{},r=n[Ve],o=n[Ye];"string"==typeof r&&"number"==typeof o&&(t[e.name]={value:o,unit:r})})),t}class ln{constructor(e={}){this._traceId=e.traceId||Te(),this._spanId=e.spanId||Ie(),this._startTime=e.startTimestamp||ke(),this._links=e.links,this._attributes={},this.setAttributes(c({[Ge]:"manual",[He]:e.op},e.attributes)),this._name=e.name,e.parentSpanId&&(this._parentSpanId=e.parentSpanId),"sampled"in e&&(this._sampled=e.sampled),e.endTimestamp&&(this._endTime=e.endTimestamp),this._events=[],this._isStandaloneSpan=e.isStandalone,this._endTime&&this._onSpanEnded()}addLink(e){return this._links?this._links.push(e):this._links=[e],this}addLinks(e){return this._links?this._links.push(...e):this._links=e,this}recordException(e,t){}spanContext(){const{_spanId:e,_traceId:t,_sampled:n}=this;return{spanId:e,traceId:t,traceFlags:n?1:0}}setAttribute(e,t){return void 0===t?delete this._attributes[e]:this._attributes[e]=t,this}setAttributes(e){return Object.keys(e).forEach((t=>this.setAttribute(t,e[t]))),this}updateStartTime(e){this._startTime=kt(e)}setStatus(e){return this._status=e,this}updateName(e){return this._name=e,this.setAttribute(ze,"custom"),this}end(e){this._endTime||(this._endTime=kt(e),function(e){if(!_)return;const{description:t="< unknown name >",op:n="< unknown op >"}=Et(e),{spanId:r}=e.spanContext(),o=`[Tracing] Finishing "${n}" ${Mt(e)===e?"root ":""}span "${t}" with ID ${r}`;O.log(o)}(this),this._onSpanEnded())}getSpanJSON(){return{data:this._attributes,description:this._name,op:this._attributes[He],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:It(this._status),timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[Ge],profile_id:this._attributes[Xe],exclusive_time:this._attributes[Qe],measurements:un(this._events),is_segment:this._isStandaloneSpan&&Mt(this)===this||void 0,segment_id:this._isStandaloneSpan?Mt(this).spanContext().spanId:void 0,links:xt(this._links)}}isRecording(){return!this._endTime&&!!this._sampled}addEvent(e,t,n){_&&O.log("[Tracing] Adding an event to span:",e);const r=pn(t)?t:n||ke(),o=pn(t)?{}:t||{},s={name:e,time:kt(r),attributes:o};return this._events.push(s),this}isStandaloneSpan(){return!!this._isStandaloneSpan}_onSpanEnded(){const e=Be();e&&e.emit("spanEnd",this);if(!(this._isStandaloneSpan||this===Mt(this)))return;if(this._isStandaloneSpan)return void(this._sampled?function(e){const t=Be();if(!t)return;const n=e[1];if(!n||0===n.length)return void t.recordDroppedEvent("before_send","span");t.sendEnvelope(e)}(function(e,t){const n=Wt(e[0]),r=null==t?void 0:t.getDsn(),o=null==t?void 0:t.getOptions().tunnel,s=c(c({sent_at:(new Date).toISOString()},!!(i=n).trace_id&&!!i.public_key&&{trace:n}),!!o&&r&&{dsn:ft(r)});var i;const{beforeSendSpan:a,ignoreSpans:u}=(null==t?void 0:t.getOptions())||{},l=(null==u?void 0:u.length)?e.filter((e=>!Lt(Et(e),u))):e,p=e.length-l.length;p&&(null==t||t.recordDroppedEvent("before_send","span",p));const d=a?e=>{const t=Et(e);return a(t)||(Rt(),t)}:Et,f=[];for(const c of l){const e=d(c);e&&f.push(tn(e))}return Yt(s,f)}([this],e)):(_&&O.log("[Tracing] Discarding standalone span because its trace was not chosen to be sampled."),e&&e.recordDroppedEvent("sample_rate","span")));const t=this._convertSpanToTransaction();if(t){(at(this).scope||Le()).captureEvent(t)}}_convertSpanToTransaction(){var e;if(!dn(Et(this)))return;this._name||(_&&O.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>");const{scope:t,isolationScope:n}=at(this),r=null==(e=null==t?void 0:t.getScopeData().sdkProcessingMetadata)?void 0:e.normalizedRequest;if(!0!==this._sampled)return;const o=$t(this).filter((e=>e!==this&&!function(e){return e instanceof ln&&e.isStandaloneSpan()}(e))).map((e=>Et(e))).filter(dn),s=this._attributes[ze];delete this._attributes[Ze],o.forEach((e=>{delete e.data[Ze]}));const i=c({contexts:{trace:bt(this)},spans:o.length>1e3?o.sort(((e,t)=>e.start_timestamp-t.start_timestamp)).slice(0,1e3):o,start_timestamp:this._startTime,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:t,capturedSpanIsolationScope:n,dynamicSamplingContext:Wt(this)},request:r},s&&{transaction_info:{source:s}}),a=un(this._events);return a&&Object.keys(a).length&&(_&&O.log("[Measurements] Adding measurements to transaction event",JSON.stringify(a,void 0,2)),i.measurements=a),i}}function pn(e){return e&&"number"==typeof e||e instanceof Date||Array.isArray(e)}function dn(e){return!!(e.start_timestamp&&e.timestamp&&e.span_id&&e.trace_id)}function fn(e,t,n=()=>{},r=()=>{}){let o;try{o=e()}catch(s){throw t(s),n(),s}return function(e,t,n,r){if(X(e))return e.then((e=>(n(),r(e),e)),(e=>{throw t(e),n(),e}));return n(),r(e),e}(o,t,n,r)}const mn="__SENTRY_SUPPRESS_TRACING__";function gn(e,t){const n=Sn();if(n.startSpan)return n.startSpan(e,t);const r=bn(e),{forceTransaction:o,parentSpan:s,scope:i}=e;return Ue(null==i?void 0:i.clone(),(()=>wn(s)((()=>{const n=Le(),i=kn(n,s),a=e.onlyIfParent&&!i?new Ht:vn({parentSpan:i,spanArguments:r,forceTransaction:o,scope:n});return Oe(n,a),fn((()=>t(a)),(()=>{const{status:e}=Et(a);!a.isRecording()||e&&"ok"!==e||a.setStatus({code:2,message:"internal_error"})}),(()=>{a.end()}))}))))}function hn(e,t){const n=Sn();if(n.startSpanManual)return n.startSpanManual(e,t);const r=bn(e),{forceTransaction:o,parentSpan:s,scope:i}=e;return Ue(null==i?void 0:i.clone(),(()=>wn(s)((()=>{const n=Le(),i=kn(n,s),a=e.onlyIfParent&&!i?new Ht:vn({parentSpan:i,spanArguments:r,forceTransaction:o,scope:n});return Oe(n,a),fn((()=>t(a,(()=>a.end()))),(()=>{const{status:e}=Et(a);!a.isRecording()||e&&"ok"!==e||a.setStatus({code:2,message:"internal_error"})}))}))))}function _n(e){const t=Sn();if(t.startInactiveSpan)return t.startInactiveSpan(e);const n=bn(e),{forceTransaction:r,parentSpan:o}=e;return(e.scope?t=>Ue(e.scope,t):void 0!==o?e=>yn(o,e):e=>e())((()=>{const t=Le(),s=kn(t,o);return e.onlyIfParent&&!s?new Ht:vn({parentSpan:s,spanArguments:n,forceTransaction:r,scope:t})}))}function yn(e,t){const n=Sn();return n.withActiveSpan?n.withActiveSpan(e,t):Ue((n=>(Oe(n,e||void 0),t(n))))}function vn({parentSpan:e,spanArguments:t,forceTransaction:n,scope:r}){if(!Nt()){const r=new Ht;if(n||!e){Bt(r,c({sampled:"false",sample_rate:"0",transaction:t.name},Wt(r)))}return r}const o=Fe();let s;if(e&&!n)s=function(e,t,n){const{spanId:r,traceId:o}=e.spanContext(),s=!t.getScopeData().sdkProcessingMetadata[mn]&&Tt(e),i=s?new ln(u(c({},n),{parentSpanId:r,traceId:o,sampled:s})):new Ht({traceId:o});Ct(e,i);const a=Be();a&&(a.emit("spanStart",i),n.endTimestamp&&a.emit("spanEnd",i));return i}(e,r,t),Ct(e,s);else if(e){const n=Wt(e),{traceId:o,spanId:i}=e.spanContext(),a=Tt(e);s=xn(c({traceId:o,parentSpanId:i},t),r,a),Bt(s,n)}else{const{traceId:e,dsc:n,parentSpanId:i,sampled:a}=c(c({},o.getPropagationContext()),r.getPropagationContext());s=xn(c({traceId:e,parentSpanId:i},t),r,a),n&&Bt(s,n)}return function(e){if(!_)return;const{description:t="< unknown name >",op:n="< unknown op >",parent_span_id:r}=Et(e),{spanId:o}=e.spanContext(),s=Tt(e),i=Mt(e),a=i===e,c=`[Tracing] Starting ${s?"sampled":"unsampled"} ${a?"root ":""}span`,u=[`op: ${n}`,`name: ${t}`,`ID: ${o}`];if(r&&u.push(`parent ID: ${r}`),!a){const{op:e,description:t}=Et(i);u.push(`root ID: ${i.spanContext().spanId}`),e&&u.push(`root op: ${e}`),t&&u.push(`root description: ${t}`)}O.log(`${c}\n  ${u.join("\n  ")}`)}(s),it(s,r,o),s}function bn(e){const t=e.experimental||{},n=c({isStandalone:t.standalone},e);if(e.startTime){const t=c({},n);return t.startTimestamp=kt(e.startTime),delete t.startTime,t}return n}function Sn(){return De(b())}function xn(e,t,n){var r,o;const s=Be(),i=(null==s?void 0:s.getOptions())||{},{name:a=""}=e,l={spanAttributes:c({},e.attributes),spanName:a,parentSampled:n};null==s||s.emit("beforeSampling",l,{decision:!1});const p=null!=(r=l.parentSampled)?r:n,d=l.spanAttributes,f=t.getPropagationContext(),[m,g,h]=t.getScopeData().sdkProcessingMetadata[mn]?[!1]:function(e,t,n){if(!Nt(e))return[!1];let r,o;"function"==typeof e.tracesSampler?(o=e.tracesSampler(u(c({},t),{inheritOrSampleWith:e=>"number"==typeof t.parentSampleRate?t.parentSampleRate:"boolean"==typeof t.parentSampled?Number(t.parentSampled):e})),r=!0):void 0!==t.parentSampled?o=t.parentSampled:void 0!==e.tracesSampleRate&&(o=e.tracesSampleRate,r=!0);const s=yt(o);if(void 0===s)return _&&O.warn(`[Tracing] Discarding root span because of invalid sample rate. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(o)} of type ${JSON.stringify(typeof o)}.`),[!1];if(!s)return _&&O.log("[Tracing] Discarding transaction because "+("function"==typeof e.tracesSampler?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0")),[!1,s,r];const i=n<s;return i||_&&O.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(o)})`),[i,s,r]}(i,{name:a,parentSampled:p,attributes:d,parentSampleRate:yt(null==(o=f.dsc)?void 0:o.sample_rate)},f.sampleRand),y=new ln(u(c({},e),{attributes:c({[ze]:"custom",[We]:void 0!==g&&h?g:void 0},d),sampled:m}));return!m&&s&&(_&&O.log("[Tracing] Discarding root span because its trace was not chosen to be sampled."),s.recordDroppedEvent("sample_rate","transaction")),s&&s.emit("spanStart",y),y}function kn(e,t){if(t)return t;if(null===t)return;const n=Ce(e);if(!n)return;const r=Be();return(r?r.getOptions():{}).parentSpanIsAlwaysRootSpan?Mt(n):n}function wn(e){return void 0!==e?t=>yn(e,t):e=>e()}const En={idleTimeout:1e3,finalTimeout:3e4,childSpanTimeout:15e3};function Tn(e,t={}){const n=new Map;let r,o=!1,s="externalFinish",i=!t.disableAutoFinish;const a=[],{idleTimeout:u=En.idleTimeout,finalTimeout:l=En.finalTimeout,childSpanTimeout:p=En.childSpanTimeout,beforeSpanEnd:d,trimIdleSpanEndTimestamp:f=!0}=t,m=Be();if(!m||!Nt()){const e=new Ht;return Bt(e,c({sample_rate:"0",sampled:"false"},Wt(e))),e}const g=Le(),h=Pt(),y=function(e){const t=_n(e);return Oe(Le(),t),_&&O.log("[Tracing] Started span is an idle span"),t}(e);function v(){r&&(clearTimeout(r),r=void 0)}function b(e){v(),r=setTimeout((()=>{!o&&0===n.size&&i&&(s="idleTimeout",y.end(e))}),u)}function S(e){r=setTimeout((()=>{!o&&i&&(s="heartbeatFailed",y.end(e))}),p)}function x(e){o=!0,n.clear(),a.forEach((e=>e())),Oe(g,h);const t=Et(y),{start_timestamp:r}=t;if(!r)return;t.data[Ke]||y.setAttribute(Ke,s);const i=t.status;i&&"unknown"!==i||y.setStatus({code:1}),O.log(`[Tracing] Idle span "${t.op}" finished`);const c=$t(y).filter((e=>e!==y));let p=0;c.forEach((t=>{t.isRecording()&&(t.setStatus({code:2,message:"cancelled"}),t.end(e),_&&O.log("[Tracing] Cancelling span since span ended early",JSON.stringify(t,void 0,2)));const n=Et(t),{timestamp:r=0,start_timestamp:o=0}=n,s=o<=e,i=r-o<=(l+u)/1e3;if(_){const e=JSON.stringify(t,void 0,2);s?i||O.log("[Tracing] Discarding span since it finished after idle span final timeout",e):O.log("[Tracing] Discarding span since it happened after idle span was finished",e)}i&&s||(!function(e,t){e[At]&&e[At].delete(t)}(y,t),p++)})),p>0&&y.setAttribute("sentry.idle_span_discarded_spans",p)}return y.end=new Proxy(y.end,{apply(e,t,n){if(d&&d(y),t instanceof Ht)return;const[r,...o]=n,s=kt(r||ke()),i=$t(y).filter((e=>e!==y)),a=Et(y);if(!i.length||!f)return x(s),Reflect.apply(e,t,[s,...o]);const c=m.getOptions().ignoreSpans,u=null==i?void 0:i.reduce(((e,t)=>{const n=Et(t);return n.timestamp?c&&Lt(n,c)?e:e?Math.max(e,n.timestamp):n.timestamp:e}),void 0),p=a.start_timestamp,g=Math.min(p?p+l/1e3:1/0,Math.max(p||-1/0,Math.min(s,u||1/0)));return x(g),Reflect.apply(e,t,[g,...o])}}),a.push(m.on("spanStart",(e=>{if(o||e===y||Et(e).timestamp||e instanceof ln&&e.isStandaloneSpan())return;var t;$t(y).includes(e)&&(t=e.spanContext().spanId,v(),n.set(t,!0),S(ke()+p/1e3))}))),a.push(m.on("spanEnd",(e=>{var t;o||(t=e.spanContext().spanId,n.has(t)&&n.delete(t),0===n.size&&b(ke()+u/1e3))}))),a.push(m.on("idleSpanEnableAutoFinish",(e=>{e===y&&(i=!0,b(),n.size&&S())}))),t.disableAutoFinish||b(),setTimeout((()=>{o||(y.setStatus({code:2,message:"deadline_exceeded"}),s="finalTimeout",y.end())}),l),y}function In(e){return new On((t=>{t(e)}))}function An(e){return new On(((t,n)=>{n(e)}))}class On{constructor(e){this._state=0,this._handlers=[],this._runExecutor(e)}then(e,t){return new On(((n,r)=>{this._handlers.push([!1,t=>{if(e)try{n(e(t))}catch(o){r(o)}else n(t)},e=>{if(t)try{n(t(e))}catch(o){r(o)}else r(e)}]),this._executeHandlers()}))}catch(e){return this.then((e=>e),e)}finally(e){return new On(((t,n)=>{let r,o;return this.then((t=>{o=!1,r=t,e&&e()}),(t=>{o=!0,r=t,e&&e()})).then((()=>{o?n(r):t(r)}))}))}_executeHandlers(){if(0===this._state)return;const e=this._handlers.slice();this._handlers=[],e.forEach((e=>{e[0]||(1===this._state&&e[1](this._value),2===this._state&&e[2](this._value),e[0]=!0)}))}_runExecutor(e){const t=(e,t)=>{0===this._state&&(X(t)?t.then(n,r):(this._state=e,this._value=t,this._executeHandlers()))},n=e=>{t(1,e)},r=e=>{t(2,e)};try{e(n,r)}catch(o){r(o)}}}function Cn(e,t,n,r=0){try{const o=$n(t,n,e,r);return X(o)?o:In(o)}catch(o){return An(o)}}function $n(e,t,n,r){const o=n[r];if(!e||!o)return e;const s=o(c({},e),t);return _&&null===s&&O.log(`Event processor "${o.id||"?"}" dropped event`),X(s)?s.then((e=>$n(e,t,n,r+1))):$n(s,t,n,r+1)}function Mn(e,t){const{fingerprint:n,span:r,breadcrumbs:o,sdkProcessingMetadata:s}=t;!function(e,t){const{extra:n,tags:r,user:o,contexts:s,level:i,transactionName:a}=t;Object.keys(n).length&&(e.extra=c(c({},n),e.extra));Object.keys(r).length&&(e.tags=c(c({},r),e.tags));Object.keys(o).length&&(e.user=c(c({},o),e.user));Object.keys(s).length&&(e.contexts=c(c({},s),e.contexts));i&&(e.level=i);a&&"transaction"!==e.type&&(e.transaction=a)}(e,t),r&&function(e,t){e.contexts=c({trace:St(t)},e.contexts),e.sdkProcessingMetadata=c({dynamicSamplingContext:Wt(t)},e.sdkProcessingMetadata);const n=Mt(t),r=Et(n).description;r&&!e.transaction&&"transaction"===e.type&&(e.transaction=r)}(e,r),function(e,t){e.fingerprint=e.fingerprint?Array.isArray(e.fingerprint)?e.fingerprint:[e.fingerprint]:[],t&&(e.fingerprint=e.fingerprint.concat(t));e.fingerprint.length||delete e.fingerprint}(e,n),function(e,t){const n=[...e.breadcrumbs||[],...t];e.breadcrumbs=n.length?n:void 0}(e,o),function(e,t){e.sdkProcessingMetadata=c(c({},e.sdkProcessingMetadata),t)}(e,s)}function Pn(e,t){const{extra:n,tags:r,user:o,contexts:s,level:i,sdkProcessingMetadata:a,breadcrumbs:u,fingerprint:l,eventProcessors:p,attachments:d,propagationContext:f,transactionName:m,span:g}=t;Rn(e,"extra",n),Rn(e,"tags",r),Rn(e,"user",o),Rn(e,"contexts",s),e.sdkProcessingMetadata=Ee(e.sdkProcessingMetadata,a,2),i&&(e.level=i),m&&(e.transactionName=m),g&&(e.span=g),u.length&&(e.breadcrumbs=[...e.breadcrumbs,...u]),l.length&&(e.fingerprint=[...e.fingerprint,...l]),p.length&&(e.eventProcessors=[...e.eventProcessors,...p]),d.length&&(e.attachments=[...e.attachments,...d]),e.propagationContext=c(c({},e.propagationContext),f)}function Rn(e,t,n){e[t]=Ee(e[t],n,1)}let jn,Nn,Dn,Ln;function Fn(e,t,n,r,o,s){const{normalizeDepth:i=3,normalizeMaxBreadth:a=1e3}=e,l=u(c({},t),{event_id:t.event_id||n.event_id||ge(),timestamp:t.timestamp||Se()}),p=n.integrations||e.integrations.map((e=>e.name));!function(e,t){var n,r;const{environment:o,release:s,dist:i,maxValueLength:a}=t;e.environment=e.environment||o||qt,!e.release&&s&&(e.release=s);!e.dist&&i&&(e.dist=i);const c=e.request;(null==c?void 0:c.url)&&a&&(c.url=le(c.url,a));a&&(null==(r=null==(n=e.exception)?void 0:n.values)||r.forEach((e=>{e.value&&(e.value=le(e.value,a))})))}(l,e),function(e,t){t.length>0&&(e.sdk=e.sdk||{},e.sdk.integrations=[...e.sdk.integrations||[],...t])}(l,p),o&&o.emit("applyFrameMetadata",t),void 0===t.type&&function(e,t){var n,r;const o=function(e){const t=y._sentryDebugIds,n=y._debugIds;if(!t&&!n)return{};const r=t?Object.keys(t):[],o=n?Object.keys(n):[];if(Ln&&r.length===Nn&&o.length===Dn)return Ln;Nn=r.length,Dn=o.length,Ln={},jn||(jn={});const s=(t,n)=>{for(const r of t){const t=n[r],o=null==jn?void 0:jn[r];if(o&&Ln&&t)Ln[o[0]]=t,jn&&(jn[r]=[o[0],t]);else if(t){const n=e(r);for(let e=n.length-1;e>=0;e--){const o=n[e],s=null==o?void 0:o.filename;if(s&&Ln&&jn){Ln[s]=t,jn[r]=[s,t];break}}}}};return t&&s(r,t),n&&s(o,n),Ln}(t);null==(r=null==(n=e.exception)?void 0:n.values)||r.forEach((e=>{var t,n;null==(n=null==(t=e.stacktrace)?void 0:t.frames)||n.forEach((e=>{e.filename&&(e.debug_id=o[e.filename])}))}))}(l,e.stackParser);const d=function(e,t){if(!t)return e;const n=e?e.clone():new $e;return n.update(t),n}(r,n.captureContext);n.mechanism&&ve(l,n.mechanism);const f=o?o.getEventProcessors():[],m=qe().getScopeData();if(s){Pn(m,s.getScopeData())}if(d){Pn(m,d.getScopeData())}const g=[...n.attachments||[],...m.attachments];g.length&&(n.attachments=g),Mn(l,m);return Cn([...f,...m.eventProcessors],l,n).then((e=>(e&&function(e){var t,n;const r={};if(null==(n=null==(t=e.exception)?void 0:t.values)||n.forEach((e=>{var t,n;null==(n=null==(t=e.stacktrace)?void 0:t.frames)||n.forEach((e=>{e.debug_id&&(e.abs_path?r[e.abs_path]=e.debug_id:e.filename&&(r[e.filename]=e.debug_id),delete e.debug_id)}))})),0===Object.keys(r).length)return;e.debug_meta=e.debug_meta||{},e.debug_meta.images=e.debug_meta.images||[];const o=e.debug_meta.images;Object.entries(r).forEach((([e,t])=>{o.push({type:"sourcemap",code_file:e,debug_id:t})}))}(e),"number"==typeof i&&i>0?function(e,t,n){var r,o;if(!e)return null;const s=c(c(c(c(c({},e),e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map((e=>c(c({},e),e.data&&{data:Gt(e.data,t,n)})))}),e.user&&{user:Gt(e.user,t,n)}),e.contexts&&{contexts:Gt(e.contexts,t,n)}),e.extra&&{extra:Gt(e.extra,t,n)});(null==(r=e.contexts)?void 0:r.trace)&&s.contexts&&(s.contexts.trace=e.contexts.trace,e.contexts.trace.data&&(s.contexts.trace.data=Gt(e.contexts.trace.data,t,n)));e.spans&&(s.spans=e.spans.map((e=>c(c({},e),e.data&&{data:Gt(e.data,t,n)}))));(null==(o=e.contexts)?void 0:o.flags)&&s.contexts&&(s.contexts.flags=Gt(e.contexts.flags,3,n));return s}(e,i,a):e)))}function qn(e){if(e)return function(e){return e instanceof $e||"function"==typeof e}(e)||function(e){return Object.keys(e).some((e=>Un.includes(e)))}(e)?{captureContext:e}:e}const Un=["user","level","extra","contexts","tags","fingerprint","propagationContext"];function Bn(e,t){return Le().captureException(e,qn(t))}function Jn(e,t){const n="string"==typeof t?t:void 0,r="string"!=typeof t?{captureContext:t}:void 0;return Le().captureMessage(e,n,r)}function zn(e,t){Fe().setExtra(e,t)}function Wn(e,t){Fe().setTag(e,t)}function Hn(){return Fe().lastEventId()}function Gn(e){Fe().addEventProcessor(e)}function Kn(e,t,n){return t||`${function(e){return`${function(e){const t=e.protocol?`${e.protocol}:`:"",n=e.port?`:${e.port}`:"";return`${t}//${e.host}${n}${e.path?`/${e.path}`:""}/api/`}(e)}${e.projectId}/envelope/`}(e)}?${function(e,t){const n={sentry_version:"7"};return e.publicKey&&(n.sentry_key=e.publicKey),t&&(n.sentry_client=`${t.name}/${t.version}`),new URLSearchParams(n).toString()}(e,n)}`}const Vn=[];function Yn(e,t){for(const n of t)(null==n?void 0:n.afterAllSetup)&&n.afterAllSetup(e)}function Zn(e,t,n){if(n[t.name])_&&O.log(`Integration skipped because it was already installed: ${t.name}`);else{if(n[t.name]=t,Vn.includes(t.name)||"function"!=typeof t.setupOnce||(t.setupOnce(),Vn.push(t.name)),t.setup&&"function"==typeof t.setup&&t.setup(e),"function"==typeof t.preprocessEvent){const n=t.preprocessEvent.bind(t);e.on("preprocessEvent",((t,r)=>n(t,r,e)))}if("function"==typeof t.processEvent){const n=t.processEvent.bind(t),r=Object.assign(((t,r)=>n(t,r,e)),{id:t.name});e.addEventProcessor(r)}_&&O.log(`Integration installed: ${t.name}`)}}function Xn(e,t){return t?Ue(t,(()=>{const n=Pt(),r=n?St(n):Je(t);return[n?Wt(n):zt(e,t),r]})):[void 0,void 0]}const Qn={trace:1,debug:5,info:9,warn:13,error:17,fatal:21};function er(e,t,n,r=!0){!n||e[t]&&!r||(e[t]=n)}function tr(e,t){const n=sr(),r=or(e);void 0===r?n.set(e,[t]):r.length>=100?(rr(e,r),n.set(e,[t])):n.set(e,[...r,t])}function nr(e,t=Le(),n=tr){var r,o,s;const i=null!=(r=null==t?void 0:t.getClient())?r:Be();if(!i)return void(_&&O.warn("No client available to capture log."));const{release:a,environment:l,enableLogs:p=!1,beforeSendLog:d}=i.getOptions();if(!p)return void(_&&O.warn("logging option not enabled, log will not be captured."));const[,f]=Xn(i,t),m=c({},e.attributes),{user:{id:g,email:h,username:y}}=function(e){const t=qe().getScopeData();return Pn(t,Fe().getScopeData()),Pn(t,e.getScopeData()),t}(t);er(m,"user.id",g,!1),er(m,"user.email",h,!1),er(m,"user.name",y,!1),er(m,"sentry.release",a),er(m,"sentry.environment",l);const{name:v,version:b}=null!=(s=null==(o=i.getSdkMetadata())?void 0:o.sdk)?s:{};er(m,"sentry.sdk.name",v),er(m,"sentry.sdk.version",b);const S=i.getIntegrationByName("Replay"),x=null==S?void 0:S.getReplayId(!0);er(m,"sentry.replay_id",x),x&&"buffer"===(null==S?void 0:S.getRecordingMode())&&er(m,"sentry._internal.replay_is_buffering",!0);const k=e.message;if(K(k)){const{__sentry_template_string__:e,__sentry_template_values__:t=[]}=k;(null==t?void 0:t.length)&&(m["sentry.message.template"]=e),t.forEach(((e,t)=>{m[`sentry.message.parameter.${t}`]=e}))}const w=Ce(t);er(m,"sentry.trace.parent_span_id",null==w?void 0:w.spanContext().spanId);const T=u(c({},e),{attributes:m});i.emit("beforeCaptureLog",T);const I=d?E((()=>d(T))):T;if(!I)return i.recordDroppedEvent("before_send","log_item",1),void(_&&O.warn("beforeSendLog returned null, log will not be captured."));const{level:A,message:C,attributes:$={},severityNumber:M}=I,P={timestamp:ke(),level:A,body:C,trace_id:null==f?void 0:f.trace_id,severity_number:null!=M?M:Qn[A],attributes:Object.keys($).reduce(((e,t)=>(e[t]=function(e){var t;switch(typeof e){case"number":return Number.isInteger(e)?{value:e,type:"integer"}:{value:e,type:"double"};case"boolean":return{value:e,type:"boolean"};case"string":return{value:e,type:"string"};default:{let r="";try{r=null!=(t=JSON.stringify(e))?t:""}catch(n){}return{value:r,type:"string"}}}}($[t]),e)),{})};n(i,P),i.emit("afterCaptureLog",I)}function rr(e,t){var n;const r=null!=(n=null!=t?t:or(e))?n:[];if(0===r.length)return;const o=e.getOptions(),s=function(e,t,n,r){const o={};return(null==t?void 0:t.sdk)&&(o.sdk={name:t.sdk.name,version:t.sdk.version}),n&&r&&(o.dsn=ft(r)),Yt(o,[(s=e,[{type:"log",item_count:s.length,content_type:"application/vnd.sentry.items.log+json"},{items:s}])]);var s}(r,o._metadata,o.tunnel,e.getDsn());sr().set(e,[]),e.emit("flushLogs"),e.sendEnvelope(s)}function or(e){return sr().get(e)}function sr(){return x("clientToLogBufferMap",(()=>new WeakMap))}function ir(e){var t;switch(typeof e){case"number":return Number.isInteger(e)?{value:e,type:"integer"}:{value:e,type:"double"};case"boolean":return{value:e,type:"boolean"};case"string":return{value:e,type:"string"};default:{let r="";try{r=null!=(t=JSON.stringify(e))?t:""}catch(n){}return{value:r,type:"string"}}}}function ar(e,t,n,r=!0){!n||!r&&t in e||(e[t]=n)}function cr(e,t){const n=fr(),r=dr(e);void 0===r?n.set(e,[t]):r.length>=1e3?(pr(e,r),n.set(e,[t])):n.set(e,[...r,t])}function ur(e,t,n){var r,o;const{release:s,environment:i}=t.getOptions(),a=c({},e.attributes),{user:{id:l,email:p,username:d}}=function(e){const t=qe().getScopeData();return Pn(t,Fe().getScopeData()),Pn(t,e.getScopeData()),t}(n);ar(a,"user.id",l,!1),ar(a,"user.email",p,!1),ar(a,"user.name",d,!1),ar(a,"sentry.release",s),ar(a,"sentry.environment",i);const{name:f,version:m}=null!=(o=null==(r=t.getSdkMetadata())?void 0:r.sdk)?o:{};ar(a,"sentry.sdk.name",f),ar(a,"sentry.sdk.version",m);const g=t.getIntegrationByName("Replay"),h=null==g?void 0:g.getReplayId(!0);return ar(a,"sentry.replay_id",h),h&&"buffer"===(null==g?void 0:g.getRecordingMode())&&ar(a,"sentry._internal.replay_is_buffering",!0),u(c({},e),{attributes:a})}function lr(e,t){var n,r,o,s;const i=null!=(n=null==t?void 0:t.scope)?n:Le(),a=null!=(r=null==t?void 0:t.captureSerializedMetric)?r:cr,c=null!=(o=null==i?void 0:i.getClient())?o:Be();if(!c)return void(_&&O.warn("No client available to capture metric."));const{_experiments:u,enableMetrics:l,beforeSendMetric:p}=c.getOptions();if(!(null==(s=null!=l?l:null==u?void 0:u.enableMetrics)||s))return void(_&&O.warn("metrics option not enabled, metric will not be captured."));const d=ur(e,c,i);c.emit("processMetric",d);const f=p||(null==u?void 0:u.beforeSendMetric),m=f?f(d):d;if(!m)return void(_&&O.log("`beforeSendMetric` returned `null`, will not send metric."));const g=function(e,t,n){const r={};for(const c in e.attributes)void 0!==e.attributes[c]&&(r[c]=ir(e.attributes[c]));const[,o]=Xn(t,n),s=Ce(n),i=s?s.spanContext().traceId:null==o?void 0:o.trace_id,a=s?s.spanContext().spanId:void 0;return{timestamp:ke(),trace_id:null!=i?i:"",span_id:a,name:e.name,type:e.type,unit:e.unit,value:e.value,attributes:r}}(m,c,i);_&&O.log("[Metric]",g),a(c,g),c.emit("afterCaptureMetric",m)}function pr(e,t){var n;const r=null!=(n=null!=t?t:dr(e))?n:[];if(0===r.length)return;const o=e.getOptions(),s=function(e,t,n,r){const o={};return(null==t?void 0:t.sdk)&&(o.sdk={name:t.sdk.name,version:t.sdk.version}),n&&r&&(o.dsn=ft(r)),Yt(o,[(s=e,[{type:"trace_metric",item_count:s.length,content_type:"application/vnd.sentry.items.trace-metric+json"},{items:s}])]);var s}(r,o._metadata,o.tunnel,e.getDsn());fr().set(e,[]),e.emit("flushMetrics"),e.sendEnvelope(s)}function dr(e){return fr().get(e)}function fr(){return x("clientToMetricBufferMap",(()=>new WeakMap))}const mr=Symbol.for("SentryBufferFullError");function gr(e=100){const t=new Set;function n(e){t.delete(e)}return{get $(){return Array.from(t)},add:function(r){if(!(t.size<e))return An(mr);const o=r();return t.add(o),o.then((()=>n(o)),(()=>n(o))),o},drain:function(e){if(!t.size)return In(!0);const n=Promise.allSettled(Array.from(t)).then((()=>!0));if(!e)return n;const r=[n,new Promise((t=>setTimeout((()=>t(!1)),e)))];return Promise.race(r)}}}function hr(e,{statusCode:t,headers:n},r=Date.now()){const o=c({},e),s=null==n?void 0:n["x-sentry-rate-limits"],i=null==n?void 0:n["retry-after"];if(s)for(const a of s.trim().split(",")){const[e,t,,,n]=a.split(":",5),s=parseInt(e,10),i=1e3*(isNaN(s)?60:s);if(t)for(const a of t.split(";"))"metric_bucket"===a&&n&&!n.split(";").includes("custom")||(o[a]=r+i);else o.all=r+i}else i?o.all=r+function(e,t=Date.now()){const n=parseInt(`${e}`,10);if(!isNaN(n))return 1e3*n;const r=Date.parse(`${e}`);return isNaN(r)?6e4:r-t}(i,r):429===t&&(o.all=r+6e4);return o}function _r(e,t,n=gr(e.bufferSize||64)){let r={};return{send:function(o){const s=[];if(Xt(o,((t,n)=>{const o=on(n);!function(e,t,n=Date.now()){return function(e,t){return e[t]||e.all||0}(e,t)>n}(r,o)?s.push(t):e.recordDroppedEvent("ratelimit_backoff",o)})),0===s.length)return Promise.resolve({});const i=Yt(o[0],s),a=t=>{Xt(i,((n,r)=>{e.recordDroppedEvent(t,on(r))}))};return n.add((()=>t({body:en(i)}).then((e=>(void 0!==e.statusCode&&(e.statusCode<200||e.statusCode>=300)&&_&&O.warn(`Sentry responded with status code ${e.statusCode} to sent event.`),r=hr(r,e),e)),(e=>{throw a("network_error"),_&&O.error("Encountered error running transport request:",e),e})))).then((e=>e),(e=>{if(e===mr)return _&&O.error("Skipped sending event because buffer is full."),a("queue_overflow"),Promise.resolve({});throw e}))},flush:e=>n.drain(e)}}function yr(e){const t=[];e.message&&t.push(e.message);try{const n=e.exception.values[e.exception.values.length-1];(null==n?void 0:n.value)&&(t.push(n.value),n.type&&t.push(`${n.type}: ${n.value}`))}catch(n){}return t}const vr="Not capturing exception because it's already been captured.",br="Discarded session because of missing or non-string release",Sr=Symbol.for("SentryInternalError"),xr=Symbol.for("SentryDoNotSendEventError");function kr(e){return{message:e,[Sr]:!0}}function wr(e){return{message:e,[xr]:!0}}function Er(e){return!!e&&"object"==typeof e&&Sr in e}function Tr(e){return!!e&&"object"==typeof e&&xr in e}function Ir(e,t,n,r,o){let s,i=0,a=!1;e.on(n,(()=>{i=0,clearTimeout(s),a=!1})),e.on(t,(t=>{i+=r(t),i>=8e5?o(e):a||(a=!0,s=setTimeout((()=>{o(e)}),5e3))})),e.on("flush",(()=>{o(e)}))}class Ar{constructor(e){var t,n,r,o,s,i,a;if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],this._promiseBuffer=gr(null!=(n=null==(t=e.transportOptions)?void 0:t.bufferSize)?n:64),e.dsn?this._dsn=_t(e.dsn):_&&O.warn("No DSN provided, client will not send events."),this._dsn){const t=Kn(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport(u(c({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this)},e.transportOptions),{url:t}))}this._options.enableLogs=null!=(o=this._options.enableLogs)?o:null==(r=this._options._experiments)?void 0:r.enableLogs,this._options.enableLogs&&Ir(this,"afterCaptureLog","flushLogs",Pr,rr);(null==(a=null!=(i=this._options.enableMetrics)?i:null==(s=this._options._experiments)?void 0:s.enableMetrics)||a)&&Ir(this,"afterCaptureMetric","flushMetrics",Mr,pr)}captureException(e,t,n){const r=ge();if(be(e))return _&&O.log(vr),r;const o=c({event_id:r},t);return this._process((()=>this.eventFromException(e,o).then((e=>this._captureEvent(e,o,n))).then((e=>e))),"error"),o.event_id}captureMessage(e,t,n,r){const o=c({event_id:ge()},n),s=K(e)?e:String(e),i=V(e),a=i?this.eventFromMessage(s,t,o):this.eventFromException(e,o);return this._process((()=>a.then((e=>this._captureEvent(e,o,r)))),i?"unknown":"error"),o.event_id}captureEvent(e,t,n){const r=ge();if((null==t?void 0:t.originalException)&&be(t.originalException))return _&&O.log(vr),r;const o=c({event_id:r},t),s=e.sdkProcessingMetadata||{},i=s.capturedSpanScope,a=s.capturedSpanIsolationScope,u=Or(e.type);return this._process((()=>this._captureEvent(e,o,i||n,a)),u),o.event_id}captureSession(e){this.sendSession(e),we(e,{init:!1})}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){return p(this,null,(function*(){const t=this._transport;if(!t)return!0;this.emit("flush");const n=yield this._isClientDoneProcessing(e),r=yield t.flush(e);return n&&r}))}close(e){return p(this,null,(function*(){const t=yield this.flush(e);return this.getOptions().enabled=!1,this.emit("close"),t}))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some((({name:e})=>e.startsWith("Spotlight"))))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const t=this._integrations[e.name];Zn(this,e,this._integrations),t||Yn(this,[e])}sendEvent(e,t={}){this.emit("beforeSendEvent",e,t);let n=an(e,this._dsn,this._options._metadata,this._options.tunnel);for(const r of t.attachments||[])n=Zt(n,nn(r));this.sendEnvelope(n).then((t=>this.emit("afterSendEvent",e,t)))}sendSession(e){const{release:t,environment:n=qt}=this._options;if("aggregates"in e){const r=e.attrs||{};if(!r.release&&!t)return void(_&&O.warn(br));r.release=r.release||t,r.environment=r.environment||n,e.attrs=r}else{if(!e.release&&!t)return void(_&&O.warn(br));e.release=e.release||t,e.environment=e.environment||n}this.emit("beforeSendSession",e);const r=function(e,t,n,r){const o=sn(n);return Yt(c(c({sent_at:(new Date).toISOString()},o&&{sdk:o}),!!r&&t&&{dsn:ft(t)}),["aggregates"in e?[{type:"sessions"},e]:[{type:"session"},e.toJSON()]])}(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(r)}recordDroppedEvent(e,t,n=1){if(this._options.sendClientReports){const r=`${e}:${t}`;_&&O.log(`Recording outcome: "${r}"${n>1?` (${n} times)`:""}`),this._outcomes[r]=(this._outcomes[r]||0)+n}}on(e,t){const n=this._hooks[e]=this._hooks[e]||new Set,r=(...e)=>t(...e);return n.add(r),()=>{n.delete(r)}}emit(e,...t){const n=this._hooks[e];n&&n.forEach((e=>e(...t)))}sendEnvelope(e){return p(this,null,(function*(){if(this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport)try{return yield this._transport.send(e)}catch(t){return _&&O.error("Error while sending envelope:",t),{}}return _&&O.error("Transport disabled"),{}}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=function(e,t){const n={};return t.forEach((t=>{t&&Zn(e,t,n)})),n}(this,e),Yn(this,e)}_updateSessionFromEvent(e,t){var n,r;let o="fatal"===t.level,s=!1;const i=null==(n=t.exception)?void 0:n.values;if(i){s=!0,o=!1;for(const e of i)if(!1===(null==(r=e.mechanism)?void 0:r.handled)){o=!0;break}}const a="ok"===e.status;(a&&0===e.errors||a&&o)&&(we(e,u(c({},o&&{status:"crashed"}),{errors:e.errors||Number(s||o)})),this.captureSession(e))}_isClientDoneProcessing(e){return p(this,null,(function*(){let t=0;for(;!e||t<e;){if(yield new Promise((e=>setTimeout(e,1))),!this._numProcessing)return!0;t++}return!1}))}_isEnabled(){return!1!==this.getOptions().enabled&&void 0!==this._transport}_prepareEvent(e,t,n,r){const o=this.getOptions(),s=Object.keys(this._integrations);return!t.integrations&&(null==s?void 0:s.length)&&(t.integrations=s),this.emit("preprocessEvent",e,t),e.type||r.setLastEventId(e.event_id||t.event_id),Fn(o,e,t,n,this,r).then((e=>{if(null===e)return e;this.emit("postprocessEvent",e,t),e.contexts=c({trace:Je(n)},e.contexts);const r=zt(this,n);return e.sdkProcessingMetadata=c({dynamicSamplingContext:r},e.sdkProcessingMetadata),e}))}_captureEvent(e,t={},n=Le(),r=Fe()){return _&&Cr(e)&&O.log(`Captured error event \`${yr(e)[0]||"<unknown>"}\``),this._processEvent(e,t,n,r).then((e=>e.event_id),(e=>{_&&(Tr(e)?O.log(e.message):Er(e)?O.warn(e.message):O.warn(e))}))}_processEvent(e,t,n,r){const o=this.getOptions(),{sampleRate:s}=o,i=$r(e),a=Cr(e),l=`before send for type \`${e.type||"error"}\``,p=void 0===s?void 0:yt(s);if(a&&"number"==typeof p&&Math.random()>p)return this.recordDroppedEvent("sample_rate","error"),An(wr(`Discarding event because it's not included in the random sample (sampling rate = ${s})`));const d=Or(e.type);return this._prepareEvent(e,t,n,r).then((e=>{if(null===e)throw this.recordDroppedEvent("event_processor",d),wr("An event processor returned `null`, will not send event.");if(t.data&&!0===t.data.__sentry__)return e;const n=function(e,t,n,r){const{beforeSend:o,beforeSendTransaction:s,beforeSendSpan:i,ignoreSpans:a}=t;let l=n;if(Cr(l)&&o)return o(l,r);if($r(l)){if(i||a){const t=function(e){var t,n,r;const{trace_id:o,parent_span_id:s,span_id:i,status:a,origin:c,data:u,op:l}=null!=(n=null==(t=e.contexts)?void 0:t.trace)?n:{};return{data:null!=u?u:{},description:e.transaction,op:l,parent_span_id:s,span_id:null!=i?i:"",start_timestamp:null!=(r=e.start_timestamp)?r:0,status:a,timestamp:e.timestamp,trace_id:null!=o?o:"",origin:c,profile_id:null==u?void 0:u[Xe],exclusive_time:null==u?void 0:u[Qe],measurements:e.measurements,is_segment:!0}}(l);if((null==a?void 0:a.length)&&Lt(t,a))return null;if(i){const e=i(t);e?l=Ee(n,{type:"transaction",timestamp:(p=e).timestamp,start_timestamp:p.start_timestamp,transaction:p.description,contexts:{trace:{trace_id:p.trace_id,span_id:p.span_id,parent_span_id:p.parent_span_id,op:p.op,status:p.status,origin:p.origin,data:c(c(c({},p.data),p.profile_id&&{[Xe]:p.profile_id}),p.exclusive_time&&{[Qe]:p.exclusive_time})}},measurements:p.measurements}):Rt()}if(l.spans){const t=[],n=l.spans;for(const e of n)if((null==a?void 0:a.length)&&Lt(e,a))Ft(n,e);else if(i){const n=i(e);n?t.push(n):(Rt(),t.push(e))}else t.push(e);const r=l.spans.length-t.length;r&&e.recordDroppedEvent("before_send","span",r),l.spans=t}}if(s){if(l.spans){const e=l.spans.length;l.sdkProcessingMetadata=u(c({},n.sdkProcessingMetadata),{spanCountBeforeProcessing:e})}return s(l,r)}}var p;return l}(this,o,e,t);return function(e,t){const n=`${t} must return \`null\` or a valid event.`;if(X(e))return e.then((e=>{if(!Y(e)&&null!==e)throw kr(n);return e}),(e=>{throw kr(`${t} rejected with ${e}`)}));if(!Y(e)&&null!==e)throw kr(n);return e}(n,l)})).then((o=>{var s;if(null===o){if(this.recordDroppedEvent("before_send",d),i){const t=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",t)}throw wr(`${l} returned \`null\`, will not send event.`)}const p=n.getSession()||r.getSession();if(a&&p&&this._updateSessionFromEvent(p,o),i){const e=((null==(s=o.sdkProcessingMetadata)?void 0:s.spanCountBeforeProcessing)||0)-(o.spans?o.spans.length:0);e>0&&this.recordDroppedEvent("before_send","span",e)}const f=o.transaction_info;if(i&&f&&o.transaction!==e.transaction){const e="custom";o.transaction_info=u(c({},f),{source:e})}return this.sendEvent(o,t),o})).then(null,(e=>{if(Tr(e)||Er(e))throw e;throw this.captureException(e,{mechanism:{handled:!1,type:"internal"},data:{__sentry__:!0},originalException:e}),kr(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: ${e}`)}))}_process(e,t){this._numProcessing++,this._promiseBuffer.add(e).then((e=>(this._numProcessing--,e)),(e=>(this._numProcessing--,e===mr&&this.recordDroppedEvent("queue_overflow",t),e)))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map((([e,t])=>{const[n,r]=e.split(":");return{reason:n,category:r,quantity:t}}))}_flushOutcomes(){_&&O.log("Flushing outcomes...");const e=this._clearOutcomes();if(0===e.length)return void(_&&O.log("No outcomes to send"));if(!this._dsn)return void(_&&O.log("No dsn provided, will not send outcomes"));_&&O.log("Sending outcomes:",e);const t=(n=e,Yt((r=this._options.tunnel&&ft(this._dsn))?{dsn:r}:{},[[{type:"client_report"},{timestamp:Se(),discarded_events:n}]]));var n,r;this.sendEnvelope(t)}}function Or(e){return"replay_event"===e?"replay":e||"error"}function Cr(e){return void 0===e.type}function $r(e){return"transaction"===e.type}function Mr(e){let t=0;return e.name&&(t+=2*e.name.length),t+=8,t+Rr(e.attributes)}function Pr(e){let t=0;return e.message&&(t+=2*e.message.length),t+Rr(e.attributes)}function Rr(e){if(!e)return 0;let t=0;return Object.values(e).forEach((e=>{Array.isArray(e)?t+=e.length*jr(e[0]):V(e)?t+=jr(e):t+=100})),t}function jr(e){return"string"==typeof e?2*e.length:"number"==typeof e?8:"boolean"==typeof e?4:0}function Nr(e,t){!0===t.debug&&(_?O.enable():E((()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")})));Le().update(t.initialScope);const n=new e(t);return function(e){Le().setClient(e)}(n),n.init(),n}function Dr(e,t){let n;return Xt(e,((e,r)=>(t.includes(r)&&(n=Array.isArray(e)?e[1]:void 0),!!n))),n}const Lr=function(e,...t){const n=new String(String.raw(e,...t));return n.__sentry_template_string__=e.join("\0").replace(/%/g,"%%").replace(/\0/g,"%s"),n.__sentry_template_values__=t,n};const Fr=100;function qr(e,t){const n=Be(),r=Fe();if(!n)return;const{beforeBreadcrumb:o=null,maxBreadcrumbs:s=Fr}=n.getOptions();if(s<=0)return;const i=Se(),a=c({timestamp:i},e),u=o?E((()=>o(a,t))):a;null!==u&&(n.emit&&n.emit("beforeAddBreadcrumb",u,t),r.addBreadcrumb(u,s))}let Ur;const Br=new WeakMap,Jr=()=>({name:"FunctionToString",setupOnce(){Ur=Function.prototype.toString;try{Function.prototype.toString=function(...e){const t=ie(this),n=Br.has(Be())&&void 0!==t?t:this;return Ur.apply(n,e)}}catch(e){}},setup(e){Br.set(e,!0)}}),zr=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,/^Can't find variable: gmo$/,/^undefined is not an object \(evaluating 'a\.[A-Z]'\)$/,'can\'t redefine non-configurable property "solana"',"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/,/^Java exception was raised during method invocation$/],Wr=(e={})=>{let t;return{name:"EventFilters",setup(n){const r=n.getOptions();t=Hr(e,r)},processEvent(n,r,o){if(!t){const n=o.getOptions();t=Hr(e,n)}return function(e,t){if(e.type){if("transaction"===e.type&&function(e,t){if(!(null==t?void 0:t.length))return!1;const n=e.transaction;return!!n&&fe(n,t)}(e,t.ignoreTransactions))return _&&O.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.\nEvent: ${_e(e)}`),!0}else{if(function(e,t){if(!(null==t?void 0:t.length))return!1;return yr(e).some((e=>fe(e,t)))}(e,t.ignoreErrors))return _&&O.warn(`Event dropped due to being matched by \`ignoreErrors\` option.\nEvent: ${_e(e)}`),!0;if(function(e){var t,n;if(!(null==(n=null==(t=e.exception)?void 0:t.values)?void 0:n.length))return!1;return!e.message&&!e.exception.values.some((e=>e.stacktrace||e.type&&"Error"!==e.type||e.value))}(e))return _&&O.warn(`Event dropped due to not having an error message, error type or stacktrace.\nEvent: ${_e(e)}`),!0;if(function(e,t){if(!(null==t?void 0:t.length))return!1;const n=Gr(e);return!!n&&fe(n,t)}(e,t.denyUrls))return _&&O.warn(`Event dropped due to being matched by \`denyUrls\` option.\nEvent: ${_e(e)}.\nUrl: ${Gr(e)}`),!0;if(!function(e,t){if(!(null==t?void 0:t.length))return!0;const n=Gr(e);return!n||fe(n,t)}(e,t.allowUrls))return _&&O.warn(`Event dropped due to not being matched by \`allowUrls\` option.\nEvent: ${_e(e)}.\nUrl: ${Gr(e)}`),!0}return!1}(n,t)?null:n}}};function Hr(e={},t={}){return{allowUrls:[...e.allowUrls||[],...t.allowUrls||[]],denyUrls:[...e.denyUrls||[],...t.denyUrls||[]],ignoreErrors:[...e.ignoreErrors||[],...t.ignoreErrors||[],...e.disableErrorDefaults?[]:zr],ignoreTransactions:[...e.ignoreTransactions||[],...t.ignoreTransactions||[]]}}function Gr(e){var t,n,r;try{const o=[...null!=(n=null==(t=e.exception)?void 0:t.values)?n:[]].reverse().find((e=>{var t,n,r;return void 0===(null==(t=e.mechanism)?void 0:t.parent_id)&&(null==(r=null==(n=e.stacktrace)?void 0:n.frames)?void 0:r.length)})),s=null==(r=null==o?void 0:o.stacktrace)?void 0:r.frames;return s?function(e=[]){for(let t=e.length-1;t>=0;t--){const n=e[t];if(n&&"<anonymous>"!==n.filename&&"[native code]"!==n.filename)return n.filename||null}return null}(s):null}catch(o){return _&&O.error(`Cannot extract url for event ${_e(e)}`),null}}const Kr=new Map,Vr=new Set;function Yr(e,t){return function(e){if(y._sentryModuleMetadata)for(const t of Object.keys(y._sentryModuleMetadata)){const n=y._sentryModuleMetadata[t];if(Vr.has(t))continue;Vr.add(t);const r=e(t);for(const e of r.reverse())if(e.filename){Kr.set(e.filename,n);break}}}(e),Kr.get(t)}function Zr(e,t){var n,r;null==(r=null==(n=t.exception)?void 0:n.values)||r.forEach((t=>{var n,r;null==(r=null==(n=t.stacktrace)?void 0:n.frames)||r.forEach((t=>{if(!t.filename||t.module_metadata)return;const n=Yr(e,t.filename);n&&(t.module_metadata=n)}))}))}function Xr(e){var t,n;null==(n=null==(t=e.exception)?void 0:t.values)||n.forEach((e=>{var t,n;null==(n=null==(t=e.stacktrace)?void 0:t.frames)||n.forEach((e=>{delete e.module_metadata}))}))}const Qr=()=>({name:"ModuleMetadata",setup(e){e.on("beforeEnvelope",(e=>{Xt(e,((e,t)=>{if("event"===t){const t=Array.isArray(e)?e[1]:void 0;t&&(Xr(t),e[1]=t)}}))})),e.on("applyFrameMetadata",(t=>{if(t.type)return;Zr(e.getOptions().stackParser,t)}))}});function eo(e){const t="console";j(t,e),N(t,to)}function to(){"console"in y&&k.forEach((function(e){e in y.console&&re(y.console,e,(function(t){return w[e]=t,function(...t){D("console",{args:t,level:e});const n=w[e];null==n||n.apply(y.console,t)}}))}))}function no(e){return"warn"===e?"warning":["fatal","error","warning","log","info","debug"].includes(e)?e:"log"}const ro=(e={})=>{var t;const n=e.levels||k,r=null==(t=e.handled)||t;return{name:"CaptureConsole",setup(e){"console"in y&&eo((({args:t,level:o})=>{Be()===e&&n.includes(o)&&function(e,t,n){const r=no(t),o=new Error,s={level:no(t),extra:{arguments:e}};Ue((i=>{if(i.addEventProcessor((e=>(e.logger="console",ve(e,{handled:n,type:"auto.core.capture_console"}),e))),"assert"===t){if(!e[0]){const t=`Assertion failed: ${pe(e.slice(1)," ")||"console.assert"}`;i.setExtra("arguments",e.slice(1)),i.captureMessage(t,r,{captureContext:s,syntheticException:o})}return}const a=e.find((e=>e instanceof Error));if(a)return void Bn(a,s);const c=pe(e," ");i.captureMessage(c,r,{captureContext:s,syntheticException:o})}))}(t,o,r)}))}}};const oo=(e={})=>{const{depth:t=3,captureErrorCause:n=!0}=e;return{name:"ExtraErrorData",processEvent(e,r,o){const{maxValueLength:s}=o.getOptions();return function(e,t={},n,r,o){if(!t.originalException||!J(t.originalException))return e;const s=t.originalException.name||t.originalException.constructor.name,i=so(t.originalException,r,o);if(i){const t=c({},e.contexts),r=Gt(i,n);return Y(r)&&(oe(r,"__sentry_skip_normalization__",!0),t[s]=r),u(c({},e),{contexts:t})}return e}(e,r,t,n,s)}}};function so(e,t,n){try{const r=["name","message","stack","line","column","fileName","lineNumber","columnNumber","toJSON"],o={};for(const t of Object.keys(e)){if(-1!==r.indexOf(t))continue;const s=e[t];o[t]=J(s)||"string"==typeof s?n?le(`${s}`,n):`${s}`:s}if(t&&void 0!==e.cause)if(J(e.cause)){const t=e.cause.name||e.cause.constructor.name;o.cause={[t]:so(e.cause,!1,n)}}else o.cause=e.cause;if("function"==typeof e.toJSON){const t=e.toJSON();for(const e of Object.keys(t)){const n=t[e];o[e]=J(n)?n.toString():n}}return o}catch(r){_&&O.error("Unable to extract extra data from the Error object:",r)}return null}const io=/^(\S+:\\|\/?)([\s\S]*?)((?:\.{1,2}|[^/\\]+?|)(\.[^./\\]*|))(?:[/\\]*)$/;function ao(...e){let t="",n=!1;for(let r=e.length-1;r>=-1&&!n;r--){const o=r>=0?e[r]:"/";o&&(t=`${o}/${t}`,n="/"===o.charAt(0))}return t=function(e,t){let n=0;for(let r=e.length-1;r>=0;r--){const t=e[r];"."===t?e.splice(r,1):".."===t?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}(t.split("/").filter((e=>!!e)),!n).join("/"),(n?"/":"")+t||"."}function co(e){let t=0;for(;t<e.length&&""===e[t];t++);let n=e.length-1;for(;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}function uo(e,t){return function(e){const t=e.length>1024?`<truncated>${e.slice(-1024)}`:e,n=io.exec(t);return n?n.slice(1):[]}(e)[2]||""}const lo=(e={})=>{const t=e.root,n=e.prefix||"app:///",r="window"in y&&!!y.window,o=e.iteratee||function({isBrowser:e,root:t,prefix:n}){return r=>{if(!r.filename)return r;const o=/^[a-zA-Z]:\\/.test(r.filename)||r.filename.includes("\\")&&!r.filename.includes("/"),s=/^\//.test(r.filename);if(e){if(t){const e=r.filename;0===e.indexOf(t)&&(r.filename=e.replace(t,n))}}else if(o||s){const e=o?r.filename.replace(/^[a-zA-Z]:/,"").replace(/\\/g,"/"):r.filename,s=t?function(e,t){e=ao(e).slice(1),t=ao(t).slice(1);const n=co(e.split("/")),r=co(t.split("/")),o=Math.min(n.length,r.length);let s=o;for(let a=0;a<o;a++)if(n[a]!==r[a]){s=a;break}let i=[];for(let a=s;a<n.length;a++)i.push("..");return i=i.concat(r.slice(s)),i.join("/")}(t,e):uo(e);r.filename=`${n}${s}`}return r}}({isBrowser:r,root:t,prefix:n});return{name:"RewriteFrames",processEvent(e){let t=e;return e.exception&&Array.isArray(e.exception.values)&&(t=function(e){try{return u(c({},e),{exception:u(c({},e.exception),{values:e.exception.values.map((e=>{return c(c({},e),e.stacktrace&&{stacktrace:(t=e.stacktrace,u(c({},t),{frames:null==(n=null==t?void 0:t.frames)?void 0:n.map((e=>o(e)))}))});var t,n}))})})}catch(t){return e}}(t)),t}}};const po=["reauthenticate","signInAnonymously","signInWithOAuth","signInWithIdToken","signInWithOtp","signInWithPassword","signInWithSSO","signOut","signUp","verifyOtp"],fo=["createUser","deleteUser","listUsers","getUserById","updateUserById","inviteUserByEmail"],mo={eq:"eq",neq:"neq",gt:"gt",gte:"gte",lt:"lt",lte:"lte",like:"like","like(all)":"likeAllOf","like(any)":"likeAnyOf",ilike:"ilike","ilike(all)":"ilikeAllOf","ilike(any)":"ilikeAnyOf",is:"is",in:"in",cs:"contains",cd:"containedBy",sr:"rangeGt",nxl:"rangeGte",sl:"rangeLt",nxr:"rangeLte",adj:"rangeAdjacent",ov:"overlaps",fts:"",plfts:"plain",phfts:"phrase",wfts:"websearch",not:"not"},go=["select","insert","upsert","update","delete"];function ho(e){try{e.__SENTRY_INSTRUMENTED__=!0}catch(t){}}function _o(e){try{return e.__SENTRY_INSTRUMENTED__}catch(t){return!1}}function yo(e,t){if(""===t||"*"===t)return"select(*)";if("select"===e)return`select(${t})`;if("or"===e||e.endsWith(".or"))return`${e}${t}`;const[n,...r]=t.split(".");let o;return o=(null==n?void 0:n.startsWith("fts"))?"textSearch":(null==n?void 0:n.startsWith("plfts"))?"textSearch[plain]":(null==n?void 0:n.startsWith("phfts"))?"textSearch[phrase]":(null==n?void 0:n.startsWith("wfts"))?"textSearch[websearch]":n&&mo[n]||"filter",`${o}(${e}, ${r.join(".")})`}function vo(e,t=!1){return new Proxy(e,{apply:(n,r,o)=>gn({name:`auth ${t?"(admin) ":""}${e.name}`,attributes:{[Ge]:"auto.db.supabase",[He]:"db","db.system":"postgresql","db.operation":`auth.${t?"admin.":""}${e.name}`}},(e=>Reflect.apply(n,r,o).then((t=>(t&&"object"==typeof t&&"error"in t&&t.error?(e.setStatus({code:2}),Bn(t.error,{mechanism:{handled:!1,type:"auto.db.supabase.auth"}})):e.setStatus({code:1}),e.end(),t))).catch((t=>{throw e.setStatus({code:2}),e.end(),Bn(t,{mechanism:{handled:!1,type:"auto.db.supabase.auth"}}),t})).then(...o)))})}function bo(e){_o(e.prototype.from)||(e.prototype.from=new Proxy(e.prototype.from,{apply(e,t,n){const r=Reflect.apply(e,t,n);return function(e){for(const t of go)_o(e.prototype[t])||(e.prototype[t]=new Proxy(e.prototype[t],{apply(e,n,r){const o=Reflect.apply(e,n,r),s=o.constructor;return _&&O.log(`Instrumenting ${t} operation's PostgRESTFilterBuilder`),So(s),o}}),ho(e.prototype[t]))}(r.constructor),r}}),ho(e.prototype.from))}function So(e){_o(e.prototype.then)||(e.prototype.then=new Proxy(e.prototype.then,{apply(e,t,n){var r;const o=go,s=t,i=function(e,t={}){var n;switch(e){case"GET":return"select";case"POST":return(null==(n=t.Prefer)?void 0:n.includes("resolution="))?"upsert":"insert";case"PATCH":return"update";case"DELETE":return"delete";default:return"<unknown-op>"}}(s.method,s.headers);if(!o.includes(i))return Reflect.apply(e,t,n);if(!(null==(r=null==s?void 0:s.url)?void 0:r.pathname)||"string"!=typeof s.url.pathname)return Reflect.apply(e,t,n);const a=s.url.pathname.split("/"),c=a.length>0?a[a.length-1]:"",u=[];for(const[f,m]of s.url.searchParams.entries())u.push(yo(f,m));const l=Object.create(null);if(Y(s.body))for(const[f,m]of Object.entries(s.body))l[f]=m;const p=`${"select"===i?"":`${i}${l?"(...) ":""}`}${u.join(" ")} from(${c})`,d={"db.table":c,"db.schema":s.schema,"db.url":s.url.origin,"db.sdk":s.headers["X-Client-Info"],"db.system":"postgresql","db.operation":i,[Ge]:"auto.db.supabase",[He]:"db"};return u.length&&(d["db.query"]=u),Object.keys(l).length&&(d["db.body"]=l),gn({name:p,attributes:d},(r=>Reflect.apply(e,t,[]).then((e=>{if(r&&(e&&"object"==typeof e&&"status"in e&&nt(r,e.status||500),r.end()),e.error){const t=new Error(e.error.message);e.error.code&&(t.code=e.error.code),e.error.details&&(t.details=e.error.details);const n={};u.length&&(n.query=u),Object.keys(l).length&&(n.body=l),Bn(t,(e=>(e.addEventProcessor((e=>(ve(e,{handled:!1,type:"auto.db.supabase.postgres"}),e))),e.setContext("supabase",n),e)))}const t={type:"supabase",category:`db.${i}`,message:p},n={};return u.length&&(n.query=u),Object.keys(l).length&&(n.body=l),Object.keys(n).length&&(t.data=n),qr(t),e}),(e=>{throw r&&(nt(r,500),r.end()),e})).then(...n)))}}),ho(e.prototype.then))}const xo=e=>{if(!e)return void(_&&O.warn("Supabase integration was not installed because no Supabase client was provided."));bo(e.constructor===Function?e:e.constructor),function(e){const t=e.auth;if(t&&!_o(e.auth)){for(const n of po){const r=t[n];r&&"function"==typeof e.auth[n]&&(e.auth[n]=vo(r))}for(const n of fo){const r=t.admin[n];r&&"function"==typeof e.auth.admin[n]&&(e.auth.admin[n]=vo(r,!0))}ho(e.auth)}}(e)},ko=e=>{return t=e.supabaseClient,{setupOnce(){xo(t)},name:"Supabase"};var t};function wo(e){return u(c({},e),{path:"path"in e&&Array.isArray(e.path)?e.path.join("."):void 0,keys:"keys"in e?JSON.stringify(e.keys):void 0,unionErrors:"unionErrors"in e?JSON.stringify(e.unionErrors):void 0})}function Eo(e){const t=new Set;for(const r of e.issues){const e=r.path.map((e=>"number"==typeof e?"<array>":e)).join(".");e.length>0&&t.add(e)}const n=Array.from(t);if(0===n.length){let t="variable";if(e.issues.length>0){const n=e.issues[0];void 0!==n&&"expected"in n&&"string"==typeof n.expected&&(t=n.expected)}return`Failed to validate ${t}`}return`Failed to validate keys: ${le(n.join(", "),100)}`}function To(e,t=!1,n,r){var o,s;if(!((null==(o=n.exception)?void 0:o.values)&&r.originalException&&(s=r.originalException,J(s)&&"ZodError"===s.name&&Array.isArray(s.issues))&&0!==r.originalException.issues.length))return n;try{const o=(t?r.originalException.issues:r.originalException.issues.slice(0,e)).map(wo);return t&&(Array.isArray(r.attachments)||(r.attachments=[]),r.attachments.push({filename:"zod_issues.json",data:JSON.stringify({issues:o})})),u(c({},n),{exception:u(c({},n.exception),{values:[u(c({},n.exception.values[0]),{value:Eo(r.originalException)}),...n.exception.values.slice(1)]}),extra:u(c({},n.extra),{"zoderror.issues":o.slice(0,e)})})}catch(i){return u(c({},n),{extra:u(c({},n.extra),{"zoderrors sentry integration parse error":{message:"an exception was thrown while processing ZodError within applyZodErrorsToEvent()",error:i instanceof Error?`${i.name}: ${i.message}\n${i.stack}`:"unknown"}})})}}const Io=(e={})=>{var t;const n=null!=(t=e.limit)?t:10;return{name:"ZodErrors",processEvent:(t,r)=>To(n,e.saveZodIssuesAsAttachment,t,r)}},Ao=e=>({name:"ThirdPartyErrorsFilter",setup(e){e.on("beforeEnvelope",(e=>{Xt(e,((e,t)=>{if("event"===t){const t=Array.isArray(e)?e[1]:void 0;t&&(Xr(t),e[1]=t)}}))})),e.on("applyFrameMetadata",(t=>{if(t.type)return;Zr(e.getOptions().stackParser,t)}))},processEvent(t){const n=function(e){const t=function(e){const t=e.exception;if(t){const e=[];try{return t.values.forEach((t=>{t.stacktrace.frames&&e.push(...t.stacktrace.frames)})),e}catch(n){return}}}(e);if(!t)return;return t.filter((e=>{var t;return!!e.filename&&null!=(null!=(t=e.lineno)?t:e.colno)})).map((e=>e.module_metadata?Object.keys(e.module_metadata).filter((e=>e.startsWith(Oo))).map((e=>e.slice(Oo.length))):[]))}(t);if(n){if(n["drop-error-if-contains-third-party-frames"===e.behaviour||"apply-tag-if-contains-third-party-frames"===e.behaviour?"some":"every"]((t=>!t.some((t=>e.filterKeys.includes(t)))))){if("drop-error-if-contains-third-party-frames"===e.behaviour||"drop-error-if-exclusively-contains-third-party-frames"===e.behaviour)return null;t.tags=u(c({},t.tags),{third_party_code:!0})}}return t}});const Oo="_sentryBundlerPluginAppKey:",Co="flag.evaluation.";function $o(e,t,n=100){const r=Le().getScopeData().contexts;r.flags||(r.flags={values:[]});!function(e,t,n,r){if("boolean"!=typeof n)return;if(e.length>r)return void(_&&O.error(`[Feature Flags] insertToFlagBuffer called on a buffer larger than maxSize=${r}`));const o=e.findIndex((e=>e.flag===t));-1!==o&&e.splice(o,1);e.length===r&&e.shift();e.push({flag:t,result:n})}(r.flags.values,e,t,n)}const Mo=()=>({name:"FeatureFlags",processEvent:(e,t,n)=>function(e){const t=Le().getScopeData().contexts.flags,n=t?t.values:[];return n.length?(void 0===e.contexts&&(e.contexts={}),e.contexts.flags={values:[...n]},e):e}(e),addFeatureFlag(e,t){$o(e,t),function(e,t,n=10){if("boolean"!=typeof t)return;const r=Pt();if(!r)return;const o=Et(r).data;if(`${Co}${e}`in o)return void r.setAttribute(`${Co}${e}`,t);Object.keys(o).filter((e=>e.startsWith(Co))).length<n&&r.setAttribute(`${Co}${e}`,t)}(e,t)}});function Po(e,t,n,r,o){nr({level:e,message:t,attributes:n,severityNumber:o},r)}const Ro=Object.freeze(Object.defineProperty({__proto__:null,debug:function(e,t,{scope:n}={}){Po("debug",e,t,n)},error:function(e,t,{scope:n}={}){Po("error",e,t,n)},fatal:function(e,t,{scope:n}={}){Po("fatal",e,t,n)},fmt:Lr,info:function(e,t,{scope:n}={}){Po("info",e,t,n)},trace:function(e,t,{scope:n}={}){Po("trace",e,t,n)},warn:function(e,t,{scope:n}={}){Po("warn",e,t,n)}},Symbol.toStringTag,{value:"Module"}));function jo(e,t,n){return"util"in y&&"function"==typeof y.util.format?y.util.format(...e):function(e,t,n){return e.map((e=>V(e)?String(e):JSON.stringify(Gt(e,t,n)))).join(" ")}(e,t,n)}const No={[Ge]:"auto.log.console"},Do=(e={})=>{const t=e.levels||k;return{name:"ConsoleLogs",setup(e){const{enableLogs:n,normalizeDepth:r=3,normalizeMaxBreadth:o=1e3}=e.getOptions();n?eo((({args:n,level:s})=>{if(Be()!==e||!t.includes(s))return;const i=n[0],a=n.slice(1);if("assert"===s){if(!i){nr({level:"error",message:a.length>0?`Assertion failed: ${jo(a,r,o)}`:"Assertion failed",attributes:No})}return}const u="log"===s,l=n.length>1&&"string"==typeof n[0]&&(p=n[0],!/%[sdifocO]/.test(p));var p;const d=c(c({},No),l?function(e,t){const n={},r=new Array(t.length).fill("{}").join(" ");return n["sentry.message.template"]=`${e} ${r}`,t.forEach(((e,t)=>{n[`sentry.message.parameter.${t}`]=e})),n}(i,a):{});nr({level:u?"info":s,message:jo(n,r,o),severityNumber:u?10:void 0,attributes:d})})):_&&O.warn("`enableLogs` is not enabled, ConsoleLogs integration disabled")}}};function Lo(e,t,n,r){lr({type:e,name:t,value:n,unit:null==r?void 0:r.unit,attributes:null==r?void 0:r.attributes},{scope:null==r?void 0:r.scope})}const Fo=Object.freeze(Object.defineProperty({__proto__:null,count:function(e,t=1,n){Lo("counter",e,t,n)},distribution:function(e,t,n){Lo("distribution",e,t,n)},gauge:function(e,t,n){Lo("gauge",e,t,n)}},Symbol.toStringTag,{value:"Module"})),qo=["trace","debug","info","warn","error","fatal"];const Uo={silent:"trace",fatal:"fatal",error:"error",warn:"warn",log:"info",info:"info",success:"info",fail:"error",ready:"info",start:"info",box:"info",debug:"debug",trace:"trace",verbose:"debug",critical:"fatal",notice:"info"},Bo={0:"fatal",1:"warn",2:"info",3:"info",4:"debug",5:"trace"};const Jo="gen_ai.prompt",zo="gen_ai.system",Wo="gen_ai.request.model",Ho="gen_ai.request.stream",Go="gen_ai.request.temperature",Ko="gen_ai.request.max_tokens",Vo="gen_ai.request.frequency_penalty",Yo="gen_ai.request.presence_penalty",Zo="gen_ai.request.top_p",Xo="gen_ai.request.top_k",Qo="gen_ai.response.finish_reasons",es="gen_ai.response.model",ts="gen_ai.response.id",ns="gen_ai.usage.input_tokens",rs="gen_ai.usage.output_tokens",os="gen_ai.usage.total_tokens",ss="gen_ai.operation.name",is="gen_ai.request.messages",as="gen_ai.response.text",cs="gen_ai.request.available_tools",us="gen_ai.response.streaming",ls="gen_ai.response.tool_calls",ps="openai.response.id",ds="openai.response.model",fs="openai.response.timestamp",ms="openai.usage.completion_tokens",gs="openai.usage.prompt_tokens",hs="chat",_s="responses",ys="embeddings",vs="anthropic.response.timestamp",bs=e=>(new TextEncoder).encode(e).length,Ss=e=>bs(JSON.stringify(e));function xs(e,t){if(bs(e)<=t)return e;let n=0,r=e.length,o="";for(;n<=r;){const s=Math.floor((n+r)/2),i=e.slice(0,s);bs(i)<=t?(o=i,n=s+1):r=s-1}return o}function ks(e){return"string"==typeof e?e:e.text}function ws(e,t){return"string"==typeof e?t:u(c({},e),{text:t})}function Es(e,t){return e&&"object"==typeof e?function(e){return null!==e&&"object"==typeof e&&"content"in e&&"string"==typeof e.content}(e)?function(e,t){const n=u(c({},e),{content:""}),r=t-Ss(n);if(r<=0)return[];const o=xs(e.content,r);return[u(c({},e),{content:o})]}(e,t):function(e){return null!==e&&"object"==typeof e&&"parts"in e&&Array.isArray(e.parts)&&e.parts.length>0}(e)?function(e,t){const{parts:n}=e,r=n.map((e=>ws(e,"")));let o=t-Ss(u(c({},e),{parts:r}));if(o<=0)return[];const s=[];for(const i of n){const e=ks(i),t=bs(e);if(!(t<=o)){if(0===s.length){const t=xs(e,o);t&&s.push(ws(i,t));break}break}s.push(i),o-=t}return s.length>0?[u(c({},e),{parts:s})]:[]}(e,t):[]:[]}function Ts(e){return function(e,t){if(!Array.isArray(e)||0===e.length)return e;if(Ss(e)<=t)return e;const n=e.map(Ss);let r=0,o=e.length;for(let s=e.length-1;s>=0;s--){const e=n[s];if(e&&r+e>t)break;e&&(r+=e),o=s}if(o===e.length)return Es(e[e.length-1],t);return e.slice(o)}(e,2e4)}function Is(e){return e.includes("messages")?"messages":e.includes("completions")?"completions":e.includes("models")?"models":e.includes("chat")?"chat":e.split(".").pop()||"unknown"}function As(e){return`gen_ai.${Is(e)}`}function Os(e,t){return e?`${e}.${t}`:t}function Cs(e,t,n,r,o){if(void 0!==t&&e.setAttributes({[ns]:t}),void 0!==n&&e.setAttributes({[rs]:n}),void 0!==t||void 0!==n||void 0!==r||void 0!==o){const s=(null!=t?t:0)+(null!=n?n:0)+(null!=r?r:0)+(null!=o?o:0);e.setAttributes({[os]:s})}}function $s(e){if("string"==typeof e)return xs(e,2e4);if(Array.isArray(e)){const t=Ts(e);return JSON.stringify(t)}return JSON.stringify(e)}const Ms=["responses.create","chat.completions.create","embeddings.create"],Ps=["response.created","response.in_progress","response.failed","response.completed","response.incomplete","response.queued","response.output_text.delta","response.output_item.added","response.function_call_arguments.delta","response.function_call_arguments.done","response.output_item.done"];function Rs(e){return e.includes("chat.completions")?hs:e.includes("responses")?_s:e.includes("embeddings")?ys:e.split(".").pop()||"unknown"}function js(e){return`gen_ai.${Rs(e)}`}function Ns(e){return null!==e&&"object"==typeof e&&"type"in e&&"string"==typeof e.type&&e.type.startsWith("response.")}function Ds(e){return null!==e&&"object"==typeof e&&"object"in e&&"chat.completion.chunk"===e.object}function Ls(e,t,n,r){void 0!==t&&e.setAttributes({[gs]:t,[ns]:t}),void 0!==n&&e.setAttributes({[ms]:n,[rs]:n}),void 0!==r&&e.setAttributes({[os]:r})}function Fs(e,t,n,r){e.setAttributes({[ps]:t,[ts]:t}),e.setAttributes({[ds]:n,[es]:n}),e.setAttributes({[fs]:new Date(1e3*r).toISOString()})}function qs(e,t){for(const n of e){const e=n.index;if(void 0!==e&&n.function)if(e in t.chatCompletionToolCalls){const r=t.chatCompletionToolCalls[e];n.function.arguments&&(null==r?void 0:r.function)&&(r.function.arguments+=n.function.arguments)}else t.chatCompletionToolCalls[e]=u(c({},n),{function:{name:n.function.name,arguments:n.function.arguments||""}})}}function Us(e,t,n){var r,o,s,i,a,c;t.responseId=null!=(r=e.id)?r:t.responseId,t.responseModel=null!=(o=e.model)?o:t.responseModel,t.responseTimestamp=null!=(s=e.created)?s:t.responseTimestamp,e.usage&&(t.promptTokens=e.usage.prompt_tokens,t.completionTokens=e.usage.completion_tokens,t.totalTokens=e.usage.total_tokens);for(const u of null!=(i=e.choices)?i:[])n&&((null==(a=u.delta)?void 0:a.content)&&t.responseTexts.push(u.delta.content),(null==(c=u.delta)?void 0:c.tool_calls)&&qs(u.delta.tool_calls,t)),u.finish_reason&&t.finishReasons.push(u.finish_reason)}function Bs(e,t,n,r){var o,s,i;if(!e||"object"!=typeof e)return void t.eventTypes.push("unknown:non-object");if(e instanceof Error)return r.setStatus({code:2,message:"internal_error"}),void Bn(e,{mechanism:{handled:!1,type:"auto.ai.openai.stream-response"}});if(!("type"in e))return;const a=e;if(Ps.includes(a.type)){if(n&&("response.output_item.done"===a.type&&"item"in a&&t.responsesApiToolCalls.push(a.item),"response.output_text.delta"===a.type&&"delta"in a&&a.delta))t.responseTexts.push(a.delta);else if("response"in a){const{response:e}=a;t.responseId=null!=(o=e.id)?o:t.responseId,t.responseModel=null!=(s=e.model)?s:t.responseModel,t.responseTimestamp=null!=(i=e.created_at)?i:t.responseTimestamp,e.usage&&(t.promptTokens=e.usage.input_tokens,t.completionTokens=e.usage.output_tokens,t.totalTokens=e.usage.total_tokens),e.status&&t.finishReasons.push(e.status),n&&e.output_text&&t.responseTexts.push(e.output_text)}}else t.eventTypes.push(a.type)}function Js(e,t,n){var r;if(!t||"object"!=typeof t)return;const o=t;if(function(e){return null!==e&&"object"==typeof e&&"object"in e&&"chat.completion"===e.object}(o)){if(function(e,t,n){if(Fs(e,t.id,t.model,t.created),t.usage&&Ls(e,t.usage.prompt_tokens,t.usage.completion_tokens,t.usage.total_tokens),Array.isArray(t.choices)){const r=t.choices.map((e=>e.finish_reason)).filter((e=>null!==e));if(r.length>0&&e.setAttributes({[Qo]:JSON.stringify(r)}),n){const n=t.choices.map((e=>{var t;return null==(t=e.message)?void 0:t.tool_calls})).filter((e=>Array.isArray(e)&&e.length>0)).flat();n.length>0&&e.setAttributes({[ls]:JSON.stringify(n)})}}}(e,o,n),n&&(null==(r=o.choices)?void 0:r.length)){const t=o.choices.map((e=>{var t;return(null==(t=e.message)?void 0:t.content)||""}));e.setAttributes({[as]:JSON.stringify(t)})}}else!function(e){return null!==e&&"object"==typeof e&&"object"in e&&"response"===e.object}(o)?function(e){if(null===e||"object"!=typeof e||!("object"in e))return!1;const t=e;return"list"===t.object&&"string"==typeof t.model&&t.model.toLowerCase().includes("embedding")}(o)&&function(e,t){e.setAttributes({[ds]:t.model,[es]:t.model}),t.usage&&Ls(e,t.usage.prompt_tokens,void 0,t.usage.total_tokens)}(e,o):(!function(e,t,n){if(Fs(e,t.id,t.model,t.created_at),t.status&&e.setAttributes({[Qo]:JSON.stringify([t.status])}),t.usage&&Ls(e,t.usage.input_tokens,t.usage.output_tokens,t.usage.total_tokens),n){const n=t;if(Array.isArray(n.output)&&n.output.length>0){const t=n.output.filter((e=>"object"==typeof e&&null!==e&&"function_call"===e.type));t.length>0&&e.setAttributes({[ls]:JSON.stringify(t)})}}}(e,o,n),n&&o.output_text&&e.setAttributes({[as]:o.output_text}))}function zs(e,t){if("messages"in t){const n=$s(t.messages);e.setAttributes({[is]:n})}if("input"in t){const n=$s(t.input);e.setAttributes({[is]:n})}}function Ws(e,t,n,r){return function(...o){return p(this,null,(function*(){const s=r||function(){var e,t,n,r;const o=Le().getClient(),s=null==o?void 0:o.getIntegrationByName("OpenAI"),i=!!s&&Boolean(null==o?void 0:o.getOptions().sendDefaultPii);return{recordInputs:null!=(t=null==(e=null==s?void 0:s.options)?void 0:e.recordInputs)?t:i,recordOutputs:null!=(r=null==(n=null==s?void 0:s.options)?void 0:n.recordOutputs)?r:i}}(),i=function(e,t){var n;const r={[zo]:"openai",[ss]:Rs(t),[Ge]:"auto.ai.openai"};if(e.length>0&&"object"==typeof e[0]&&null!==e[0]){const t=e[0],n=[...Array.isArray(t.tools)?t.tools:[],...t.web_search_options&&"object"==typeof t.web_search_options?[c({type:"web_search_options"},t.web_search_options)]:[]];n.length>0&&(r[cs]=JSON.stringify(n))}if(e.length>0&&"object"==typeof e[0]&&null!==e[0]){const t=e[0];r[Wo]=null!=(n=t.model)?n:"unknown","temperature"in t&&(r[Go]=t.temperature),"top_p"in t&&(r[Zo]=t.top_p),"frequency_penalty"in t&&(r[Vo]=t.frequency_penalty),"presence_penalty"in t&&(r[Yo]=t.presence_penalty),"stream"in t&&(r[Ho]=t.stream),"encoding_format"in t&&(r["gen_ai.request.encoding_format"]=t.encoding_format),"dimensions"in t&&(r["gen_ai.request.dimensions"]=t.dimensions)}else r[Wo]="unknown";return r}(o,t),a=i[Wo]||"unknown",u=Rs(t),l=o[0];return l&&"object"==typeof l&&!0===l.stream?hn({name:`${u} ${a} stream-response`,op:js(t),attributes:i},(r=>p(null,null,(function*(){var i;try{s.recordInputs&&o[0]&&"object"==typeof o[0]&&zs(r,o[0]);return function(e,t,n){return f(this,null,(function*(){const r={eventTypes:[],responseTexts:[],finishReasons:[],responseId:"",responseModel:"",responseTimestamp:0,promptTokens:void 0,completionTokens:void 0,totalTokens:void 0,chatCompletionToolCalls:{},responsesApiToolCalls:[]};try{try{for(var o,s,i,a=m(e);o=!(s=yield new d(a.next())).done;o=!1){const e=s.value;Ds(e)?Us(e,r,n):Ns(e)&&Bs(e,r,n,t),yield e}}catch(s){i=[s]}finally{try{o&&(s=a.return)&&(yield new d(s.call(a)))}finally{if(i)throw i[0]}}}finally{Fs(t,r.responseId,r.responseModel,r.responseTimestamp),Ls(t,r.promptTokens,r.completionTokens,r.totalTokens),t.setAttributes({[us]:!0}),r.finishReasons.length&&t.setAttributes({[Qo]:JSON.stringify(r.finishReasons)}),n&&r.responseTexts.length&&t.setAttributes({[as]:r.responseTexts.join("")});const e=[...Object.values(r.chatCompletionToolCalls),...r.responsesApiToolCalls];e.length>0&&t.setAttributes({[ls]:JSON.stringify(e)}),t.end()}}))}(yield e.apply(n,o),r,null!=(i=s.recordOutputs)&&i)}catch(a){throw r.setStatus({code:2,message:"internal_error"}),Bn(a,{mechanism:{handled:!1,type:"auto.ai.openai.stream",data:{function:t}}}),r.end(),a}})))):gn({name:`${u} ${a}`,op:js(t),attributes:i},(r=>p(null,null,(function*(){try{s.recordInputs&&o[0]&&"object"==typeof o[0]&&zs(r,o[0]);const t=yield e.apply(n,o);return Js(r,t,s.recordOutputs),t}catch(i){throw Bn(i,{mechanism:{handled:!1,type:"auto.ai.openai",data:{function:t}}}),i}}))))}))}}function Hs(e,t="",n){return new Proxy(e,{get(e,r){const o=e[r],s=function(e,t){return e?`${e}.${t}`:t}(t,String(r));return"function"==typeof o&&function(e){return Ms.includes(e)}(s)?Ws(o,s,e,n):"function"==typeof o?o.bind(e):o&&"object"==typeof o?Hs(o,s,n):o}})}function Gs(e,t,n,r){if(!e||"object"!=typeof e)return;const o=function(e,t){var n,r;return"type"in e&&"string"==typeof e.type&&"error"===e.type&&(t.setStatus({code:2,message:null!=(r=null==(n=e.error)?void 0:n.type)?r:"internal_error"}),Bn(e.error,{mechanism:{handled:!1,type:"auto.ai.anthropic.anthropic_error"}}),!0)}(e,r);o||(function(e,t){if("message_delta"===e.type&&e.usage&&"output_tokens"in e.usage&&"number"==typeof e.usage.output_tokens&&(t.completionTokens=e.usage.output_tokens),e.message){const n=e.message;n.id&&(t.responseId=n.id),n.model&&(t.responseModel=n.model),n.stop_reason&&t.finishReasons.push(n.stop_reason),n.usage&&("number"==typeof n.usage.input_tokens&&(t.promptTokens=n.usage.input_tokens),"number"==typeof n.usage.cache_creation_input_tokens&&(t.cacheCreationInputTokens=n.usage.cache_creation_input_tokens),"number"==typeof n.usage.cache_read_input_tokens&&(t.cacheReadInputTokens=n.usage.cache_read_input_tokens))}}(e,t),function(e,t){"content_block_start"===e.type&&"number"==typeof e.index&&e.content_block&&("tool_use"!==e.content_block.type&&"server_tool_use"!==e.content_block.type||(t.activeToolBlocks[e.index]={id:e.content_block.id,name:e.content_block.name,inputJsonParts:[]}))}(e,t),function(e,t,n){if("content_block_delta"===e.type&&e.delta){if("number"==typeof e.index&&"partial_json"in e.delta&&"string"==typeof e.delta.partial_json){const n=t.activeToolBlocks[e.index];n&&n.inputJsonParts.push(e.delta.partial_json)}n&&"string"==typeof e.delta.text&&t.responseTexts.push(e.delta.text)}}(e,t,n),function(e,t){if("content_block_stop"!==e.type||"number"!=typeof e.index)return;const n=t.activeToolBlocks[e.index];if(!n)return;const r=n.inputJsonParts.join("");let o;try{o=r?JSON.parse(r):{}}catch(s){o={__unparsed:r}}t.toolCalls.push({type:"tool_use",id:n.id,name:n.name,input:o}),delete t.activeToolBlocks[e.index]}(e,t))}function Ks(e,t,n){const r={responseTexts:[],finishReasons:[],responseId:"",responseModel:"",promptTokens:void 0,completionTokens:void 0,cacheCreationInputTokens:void 0,cacheReadInputTokens:void 0,toolCalls:[],activeToolBlocks:{}};return e.on("streamEvent",(e=>{Gs(e,r,n,t)})),e.on("message",(()=>{!function(e,t,n){t.isRecording()&&(e.responseId&&t.setAttributes({[ts]:e.responseId}),e.responseModel&&t.setAttributes({[es]:e.responseModel}),Cs(t,e.promptTokens,e.completionTokens,e.cacheCreationInputTokens,e.cacheReadInputTokens),t.setAttributes({[us]:!0}),e.finishReasons.length>0&&t.setAttributes({[Qo]:JSON.stringify(e.finishReasons)}),n&&e.responseTexts.length>0&&t.setAttributes({[as]:e.responseTexts.join("")}),n&&e.toolCalls.length>0&&t.setAttributes({[ls]:JSON.stringify(e.toolCalls)}),t.end())}(r,t,n)})),e.on("error",(e=>{Bn(e,{mechanism:{handled:!1,type:"auto.ai.anthropic.stream_error"}}),t.isRecording()&&(t.setStatus({code:2,message:"stream_error"}),t.end())})),e}const Vs=["messages.create","messages.stream","messages.countTokens","models.get","completions.create","models.retrieve","beta.messages.create"];function Ys(e,t){if("messages"in t){const n=$s(t.messages);e.setAttributes({[is]:n})}if("input"in t){const n=$s(t.input);e.setAttributes({[is]:n})}"prompt"in t&&e.setAttributes({[Jo]:JSON.stringify(t.prompt)})}function Zs(e,t,n){t&&"object"==typeof t&&("type"in t&&"error"===t.type?function(e,t){t.error&&(e.setStatus({code:2,message:t.error.type||"internal_error"}),Bn(t.error,{mechanism:{handled:!1,type:"auto.ai.anthropic.anthropic_error"}}))}(e,t):(n&&function(e,t){if("content"in t&&Array.isArray(t.content)){e.setAttributes({[as]:t.content.map((e=>e.text)).filter((e=>!!e)).join("")});const n=[];for(const e of t.content)"tool_use"!==e.type&&"server_tool_use"!==e.type||n.push(e);n.length>0&&e.setAttributes({[ls]:JSON.stringify(n)})}"completion"in t&&e.setAttributes({[as]:t.completion}),"input_tokens"in t&&e.setAttributes({[as]:JSON.stringify(t.input_tokens)})}(e,t),function(e,t){"id"in t&&"model"in t&&(e.setAttributes({[ts]:t.id,[es]:t.model}),"created"in t&&"number"==typeof t.created&&e.setAttributes({[vs]:new Date(1e3*t.created).toISOString()}),"created_at"in t&&"number"==typeof t.created_at&&e.setAttributes({[vs]:new Date(1e3*t.created_at).toISOString()}),"usage"in t&&t.usage&&Cs(e,t.usage.input_tokens,t.usage.output_tokens,t.usage.cache_creation_input_tokens,t.usage.cache_read_input_tokens))}(e,t)))}function Xs(e,t,n){throw Bn(e,{mechanism:{handled:!1,type:"auto.ai.anthropic",data:{function:n}}}),t.isRecording()&&(t.setStatus({code:2,message:"internal_error"}),t.end()),e}function Qs(e,t,n,r,o,s,i,a,c,u,l){var g;const h={name:`${s} ${null!=(g=o[Wo])?g:"unknown"} stream-response`,op:As(i),attributes:o};return hn(h,u&&!l?t=>p(null,null,(function*(){var o;try{c.recordInputs&&a&&Ys(t,a);return function(e,t,n){return f(this,null,(function*(){const r={responseTexts:[],finishReasons:[],responseId:"",responseModel:"",promptTokens:void 0,completionTokens:void 0,cacheCreationInputTokens:void 0,cacheReadInputTokens:void 0,toolCalls:[],activeToolBlocks:{}};try{try{for(var o,s,i,a=m(e);o=!(s=yield new d(a.next())).done;o=!1){const e=s.value;Gs(e,r,n,t),yield e}}catch(s){i=[s]}finally{try{o&&(s=a.return)&&(yield new d(s.call(a)))}finally{if(i)throw i[0]}}}finally{r.responseId&&t.setAttributes({[ts]:r.responseId}),r.responseModel&&t.setAttributes({[es]:r.responseModel}),Cs(t,r.promptTokens,r.completionTokens,r.cacheCreationInputTokens,r.cacheReadInputTokens),t.setAttributes({[us]:!0}),r.finishReasons.length>0&&t.setAttributes({[Qo]:JSON.stringify(r.finishReasons)}),n&&r.responseTexts.length>0&&t.setAttributes({[as]:r.responseTexts.join("")}),n&&r.toolCalls.length>0&&t.setAttributes({[ls]:JSON.stringify(r.toolCalls)}),t.end()}}))}(yield e.apply(n,r),t,null!=(o=c.recordOutputs)&&o)}catch(s){return Xs(s,t,i)}})):e=>{var o;try{c.recordInputs&&a&&Ys(e,a);return Ks(t.apply(n,r),e,null!=(o=c.recordOutputs)&&o)}catch(s){return Xs(s,e,i)}})}function ei(e,t,n,r){return new Proxy(e,{apply(o,s,i){var a;const c=function(e,t){var n;const r={[zo]:"anthropic",[ss]:Is(t),[Ge]:"auto.ai.anthropic"};if(e.length>0&&"object"==typeof e[0]&&null!==e[0]){const t=e[0];t.tools&&Array.isArray(t.tools)&&(r[cs]=JSON.stringify(t.tools)),r[Wo]=null!=(n=t.model)?n:"unknown","temperature"in t&&(r[Go]=t.temperature),"top_p"in t&&(r[Zo]=t.top_p),"stream"in t&&(r[Ho]=t.stream),"top_k"in t&&(r[Xo]=t.top_k),"frequency_penalty"in t&&(r[Vo]=t.frequency_penalty),"max_tokens"in t&&(r[Ko]=t.max_tokens)}else r[Wo]="models.retrieve"===t||"models.get"===t?e[0]:"unknown";return r}(i,t),u=null!=(a=c[Wo])?a:"unknown",l=Is(t),p="object"==typeof i[0]?i[0]:void 0,d=Boolean(null==p?void 0:p.stream),f="messages.stream"===t;return d||f?Qs(e,o,n,i,c,l,t,p,r,d,f):gn({name:`${l} ${u}`,op:As(t),attributes:c},(e=>(r.recordInputs&&p&&Ys(e,p),fn((()=>o.apply(n,i)),(e=>{Bn(e,{mechanism:{handled:!1,type:"auto.ai.anthropic",data:{function:t}}})}),(()=>{}),(t=>Zs(e,t,r.recordOutputs))))))}})}function ti(e,t="",n){return new Proxy(e,{get(e,r){const o=e[r],s=Os(t,String(r));return"function"==typeof o&&function(e){return Vs.includes(e)}(s)?ei(o,s,e,n):"function"==typeof o?o.bind(e):o&&"object"==typeof o?ti(o,s,n):o}})}const ni=["models.generateContent","models.generateContentStream","chats.create","sendMessage","sendMessageStream"],ri="chats.create";function oi(e,t,n,r){e&&!function(e,t){var n;const r=null==e?void 0:e.promptFeedback;if(null==r?void 0:r.blockReason){const e=null!=(n=r.blockReasonMessage)?n:r.blockReason;return t.setStatus({code:2,message:`Content blocked: ${e}`}),Bn(`Content blocked: ${e}`,{mechanism:{handled:!1,type:"auto.ai.google_genai"}}),!0}return!1}(e,r)&&(function(e,t){"string"==typeof e.responseId&&(t.responseId=e.responseId),"string"==typeof e.modelVersion&&(t.responseModel=e.modelVersion);const n=e.usageMetadata;n&&("number"==typeof n.promptTokenCount&&(t.promptTokens=n.promptTokenCount),"number"==typeof n.candidatesTokenCount&&(t.completionTokens=n.candidatesTokenCount),"number"==typeof n.totalTokenCount&&(t.totalTokens=n.totalTokenCount))}(e,t),function(e,t,n){var r,o,s;Array.isArray(e.functionCalls)&&t.toolCalls.push(...e.functionCalls);for(const i of null!=(r=e.candidates)?r:[]){(null==i?void 0:i.finishReason)&&!t.finishReasons.includes(i.finishReason)&&t.finishReasons.push(i.finishReason);for(const e of null!=(s=null==(o=null==i?void 0:i.content)?void 0:o.parts)?s:[])n&&e.text&&t.responseTexts.push(e.text),e.functionCall&&t.toolCalls.push({type:"function",id:e.functionCall.id,name:e.functionCall.name,arguments:e.functionCall.args})}}(e,t,n))}function si(e,t){if("model"in e&&"string"==typeof e.model)return e.model;if(t&&"object"==typeof t){const e=t;if("model"in e&&"string"==typeof e.model)return e.model;if("modelVersion"in e&&"string"==typeof e.modelVersion)return e.modelVersion}return"unknown"}function ii(e,t,n){const r={[zo]:"google_genai",[ss]:Is(e),[Ge]:"auto.ai.google_genai"};if(t){if(r[Wo]=si(t,n),"config"in t&&"object"==typeof t.config&&t.config){const e=t.config;if(Object.assign(r,function(e){const t={};return"temperature"in e&&"number"==typeof e.temperature&&(t[Go]=e.temperature),"topP"in e&&"number"==typeof e.topP&&(t[Zo]=e.topP),"topK"in e&&"number"==typeof e.topK&&(t[Xo]=e.topK),"maxOutputTokens"in e&&"number"==typeof e.maxOutputTokens&&(t[Ko]=e.maxOutputTokens),"frequencyPenalty"in e&&"number"==typeof e.frequencyPenalty&&(t[Vo]=e.frequencyPenalty),"presencePenalty"in e&&"number"==typeof e.presencePenalty&&(t[Yo]=e.presencePenalty),t}(e)),"tools"in e&&Array.isArray(e.tools)){const t=e.tools.flatMap((e=>e.functionDeclarations));r[cs]=JSON.stringify(t)}}}else r[Wo]=si({},n);return r}function ai(e,t){if("contents"in t){const n=$s(t.contents);e.setAttributes({[is]:n})}if("message"in t){const n=$s(t.message);e.setAttributes({[is]:n})}if("history"in t){const n=$s(t.history);e.setAttributes({[is]:n})}}function ci(e,t,n,r){const o=t===ri;return new Proxy(e,{apply(e,s,i){var a;const c=i[0],u=ii(t,c,n),l=null!=(a=u[Wo])?a:"unknown",g=Is(t);return function(e){return e.includes("Stream")||e.endsWith("generateContentStream")||e.endsWith("sendMessageStream")}(t)?hn({name:`${g} ${l} stream-response`,op:As(t),attributes:u},(o=>p(null,null,(function*(){try{r.recordInputs&&c&&ai(o,c);return function(e,t,n){return f(this,null,(function*(){const r={responseTexts:[],finishReasons:[],toolCalls:[]};try{try{for(var o,s,i,a=m(e);o=!(s=yield new d(a.next())).done;o=!1){const e=s.value;oi(e,r,n,t),yield e}}catch(s){i=[s]}finally{try{o&&(s=a.return)&&(yield new d(s.call(a)))}finally{if(i)throw i[0]}}}finally{const e={[us]:!0};r.responseId&&(e[ts]=r.responseId),r.responseModel&&(e[es]=r.responseModel),void 0!==r.promptTokens&&(e[ns]=r.promptTokens),void 0!==r.completionTokens&&(e[rs]=r.completionTokens),void 0!==r.totalTokens&&(e[os]=r.totalTokens),r.finishReasons.length&&(e[Qo]=JSON.stringify(r.finishReasons)),n&&r.responseTexts.length&&(e[as]=r.responseTexts.join("")),n&&r.toolCalls.length&&(e[ls]=JSON.stringify(r.toolCalls)),t.setAttributes(e),t.end()}}))}(yield e.apply(n,i),o,Boolean(r.recordOutputs))}catch(s){throw o.setStatus({code:2,message:"internal_error"}),Bn(s,{mechanism:{handled:!1,type:"auto.ai.google_genai",data:{function:t}}}),o.end(),s}})))):gn({name:o?`${g} ${l} create`:`${g} ${l}`,op:As(t),attributes:u},(s=>(r.recordInputs&&c&&ai(s,c),fn((()=>e.apply(n,i)),(e=>{Bn(e,{mechanism:{handled:!1,type:"auto.ai.google_genai",data:{function:t}}})}),(()=>{}),(e=>{o||function(e,t,n){if(t&&"object"==typeof t){if(t.usageMetadata&&"object"==typeof t.usageMetadata){const n=t.usageMetadata;"number"==typeof n.promptTokenCount&&e.setAttributes({[ns]:n.promptTokenCount}),"number"==typeof n.candidatesTokenCount&&e.setAttributes({[rs]:n.candidatesTokenCount}),"number"==typeof n.totalTokenCount&&e.setAttributes({[os]:n.totalTokenCount})}if(n&&Array.isArray(t.candidates)&&t.candidates.length>0){const n=t.candidates.map((e=>{var t;return(null==(t=e.content)?void 0:t.parts)&&Array.isArray(e.content.parts)?e.content.parts.map((e=>"string"==typeof e.text?e.text:"")).filter((e=>e.length>0)).join(""):""})).filter((e=>e.length>0));n.length>0&&e.setAttributes({[as]:n.join("")})}if(n&&t.functionCalls){const n=t.functionCalls;Array.isArray(n)&&n.length>0&&e.setAttributes({[ls]:JSON.stringify(n)})}}}(s,e,r.recordOutputs)})))))}})}function ui(e,t="",n){return new Proxy(e,{get:(e,r,o)=>{const s=Reflect.get(e,r,o),i=Os(t,String(r));if("function"==typeof s&&function(e){if(ni.includes(e))return!0;const t=e.split(".").pop();return ni.includes(t)}(i)){if(i===ri){const t=ci(s,i,e,n);return function(...e){const r=t(...e);return r&&"object"==typeof r?ui(r,"chat",n):r}}return ci(s,i,e,n)}return"function"==typeof s?s.bind(e):s&&"object"==typeof s?ui(s,i,n):s}})}const li="sentry.javascript.miniapp",pi="10.27.0-rc.2",di="?",fi=/^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,mi=/\((\S*)(?::(\d+))(?::(\d+))\)/,gi=/^\s*at (.*?) ?\((\S*):(\d+):(\d+)\)/i;function hi(e){let t=null;const n=e&&e.framesToPop;try{if(t=function(e){if(!e||!e.stacktrace)return null;const t=e.stacktrace,n=/ line (\d+).*script (?:in )?(\S+)(?:: in function (\S+))?$/i,r=/ line (\d+), column (\d+)\s*(?:in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\))? in (.*):\s*$/i,o=t.split("\n"),s=[];let i;for(let a=0;a<o.length;a+=2){let e=null;(i=n.exec(o[a]))?e={url:i[2],func:i[3],args:[],line:+i[1],column:null}:(i=r.exec(o[a]))&&(e={url:i[6],func:i[3]||i[4],args:i[5]?i[5].split(","):[],line:+i[1],column:+i[2]}),e&&(!e.func&&e.line&&(e.func=di),s.push(e))}if(!s.length)return null;return{message:yi(e),name:e.name,stack:s}}(e),t)return _i(t,n)}catch(r){}try{if(t=function(e){if(!e||!e.stack)return null;const t=[],n=e.stack.split("\n");let r,o,s,i;for(let a=0;a<n.length;++a){if(s=fi.exec(n[a])){const e=s[2]&&0===s[2].indexOf("native");r=s[2]&&0===s[2].indexOf("eval"),r&&(o=mi.exec(s[2]))&&(s[2]=o[1],s[3]=o[2],s[4]=o[3]),i={url:s[2],func:s[1]||di,args:e?[s[2]]:[],line:s[3]?+s[3]:null,column:s[4]?+s[4]:null}}else{if(!(s=gi.exec(n[a])))continue;i={url:s[2],func:s[1]||di,args:[],line:s[3]?+s[3]:null,column:s[4]?+s[4]:null}}!i.func&&i.line&&(i.func=di),t.push(i)}if(!t.length)return null;return{message:yi(e),name:e.name,stack:t}}(e),t)return _i(t,n)}catch(r){}return{message:yi(e),name:e&&e.name,stack:[],failed:!0}}function _i(e,t){try{return u(c({},e),{stack:e.stack.slice(t)})}catch(n){return e}}function yi(e){const t=e&&e.message;return t?t.error&&"string"==typeof t.error.message?t.error.message:t:"No error message"}function vi(e){const t=Ai(hi(e).stack),n={type:bi(e),value:Si(e)};return t.length&&(n.stacktrace={frames:t}),void 0===n.type&&""===n.value&&(n.value="Unrecoverable error caught"),n}function bi(e){const t=null==e?void 0:e.name;if(!t&&xi(e)){return e.message&&Array.isArray(e.message)&&2==e.message.length?e.message[0]:"WebAssembly.Exception"}return t}function Si(e){const t=null==e?void 0:e.message;return xi(e)?Array.isArray(e.message)&&2==e.message.length?e.message[1]:"wasm exception":t?t.error&&"string"==typeof t.error.message?t.error.message:t:"No error message"}function xi(e){return"undefined"!=typeof WebAssembly&&void 0!==WebAssembly.Exception&&e instanceof WebAssembly.Exception}function ki(e,t,n){const r=Be(),o=null==r?void 0:r.getOptions().normalizeDepth,s=function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];if(n instanceof Error)return n}return}(e),i={__serialized__:Kt(e,o)};if(s)return{exception:{values:[vi(s)]},extra:i};const a={exception:{values:[{type:Z(e)?e.constructor.name:n?"UnhandledRejection":"Error",value:Ii(e,{isUnhandledRejection:n})}]},extra:i};if(t){const e=Ai(hi(t).stack);e.length&&(a.exception.values[0].stacktrace={frames:e})}return a}function wi(e){return{exception:{values:[vi(e)]}}}function Ei(e,t,n){const r=function(e,t,n,r){let o;if(W(e)&&e.error){return wi(e.error)}if(H(e)||(s=e,z(s,"DOMException"))){const r=e;if("stack"in e)o=wi(e);else{const e=r.name||(H(r)?"DOMError":"DOMException"),s=r.message?`${e}: ${r.message}`:e;o=Ti(s,t,n),ye(o,s)}return"code"in r&&(o.tags=u(c({},o.tags),{"DOMException.code":`${r.code}`})),o}var s;if(J(e))return wi(e);if(Y(e)||Z(e)){return o=ki(e,t,r),ve(o,{synthetic:!0}),o}return o=Ti(e,t,n),ye(o,`${e}`),ve(o,{synthetic:!0}),o}(e,(null==t?void 0:t.syntheticException)||void 0,n);return ve(r),r.level="error",(null==t?void 0:t.event_id)&&(r.event_id=t.event_id),In(r)}function Ti(e,t,n){const r={};if(n&&t){const n=Ai(hi(t).stack);n.length&&(r.exception={values:[{value:e,stacktrace:{frames:n}}]}),ve(r,{synthetic:!0})}if(K(e)){const{__sentry_template_string__:t,__sentry_template_values__:n}=e;return r.logentry={message:t,params:n},r}return r.message=e,r}function Ii(e,{isUnhandledRejection:t}){const n=function(e){const t=Object.keys(ae(e));return t.sort(),t[0]?t.join(", "):"[object has no keys]"}(e),r="exception";if(W(e))return`Event \`ErrorEvent\` captured as ${r} with message \`${e.message}\``;if(Z(e)){return`Event \`${function(e){try{const t=Object.getPrototypeOf(e);return t?t.constructor.name:void 0}catch(t){}}(e)}\` (type=${e.type}) captured as ${r}`}return`Object captured as ${r} with keys: ${n}`}function Ai(e){if(!e||!e.length)return[];let t=e;const n=t[0].func||"",r=t[t.length-1].func||"";return-1===n.indexOf("captureMessage")&&-1===n.indexOf("captureException")||(t=t.slice(1)),-1!==r.indexOf("sentryWrapped")&&(t=t.slice(0,-1)),t.map((e=>({colno:null===e.column?void 0:e.column,filename:e.url||t[0].url,function:e.func||"?",in_app:!0,lineno:null===e.line?void 0:e.line}))).slice(0,100).reverse()}const Oi=(()=>{let e={request:()=>{},httpRequest:()=>{},getSystemInfoSync:()=>{},getPerformance:()=>({}),onAppHide:function(e){},canIUse:function(e){return!1}};if("object"==typeof wx)e=wx;else if("object"==typeof my)e=my;else if("object"==typeof tt)e=tt;else if("object"==typeof dd)e=dd;else if("object"==typeof qq)e=qq;else{if("object"!=typeof swan)throw new Error("sentry-miniapp ");e=swan}return e})(),Ci=(()=>{let e="unknown";return"object"==typeof wx?e="wechat":"object"==typeof my?e="alipay":"object"==typeof tt?e="bytedance":"object"==typeof dd?e="dingtalk":"object"==typeof qq?e="qq":"object"==typeof swan&&(e="swan"),e})();function $i(e){return _r(e,(function(t){return new On(((n,r)=>{const o=Oi.request||Oi.httpRequest;"function"==typeof o?o({url:e.url,method:"POST",data:t.body,header:{"content-type":"application/json"},success(e){var t,r,o,s;n({statusCode:null==e?void 0:e.statusCode,headers:{"x-sentry-rate-limits":null!=(r=null==(t=null==e?void 0:e.headers)?void 0:t["X-Sentry-Rate-Limits"])?r:null,"retry-after":null!=(s=null==(o=null==e?void 0:e.headers)?void 0:o["Retry-After"])?s:null}})},fail(e){r(e)}}):r(new Error("Miniapp request function is not available"))}))}))}const Mi=Object.freeze(Object.defineProperty({__proto__:null,makeMiniappTransport:$i},Symbol.toStringTag,{value:"Module"})),Pi=()=>[];class Ri extends Ar{constructor(e={}){const t=e.transport||$i,n=e.stackParser||Pi,r=e.integrations||e.defaultIntegrations||[],o=u(c({},e),{transport:t,stackParser:n,integrations:r,dsn:e.dsn,tracesSampleRate:e.tracesSampleRate});!function(e,t,n=[t],r="npm"){const o=e._metadata||{};o.sdk||(o.sdk={name:`sentry.javascript.${t}`,packages:n.map((e=>({name:`${r}:@sentry/${e}`,version:v}))),version:v}),e._metadata=o}(o,"miniapp",["miniapp"]),super(o)}_prepareEvent(e,t,n,r){return e.platform=e.platform||"javascript",e.sdk=u(c({},e.sdk),{name:li,packages:[...e.sdk&&e.sdk.packages||[],{name:"npm:@sentry/miniapp",version:pi}],version:pi}),super._prepareEvent(e,t,n,r)}showReportDialog(e={}){console.log("sentry-miniapp ",e)}eventFromException(e,t){return Ei(e,t,this._options.attachStacktrace)}eventFromMessage(e,t="info",n){return function(e,t="info",n,r){const o=Ti(e,(null==n?void 0:n.syntheticException)||void 0,r);return o.level=t,(null==n?void 0:n.event_id)&&(o.event_id=n.event_id),In(o)}(e,t,n,this._options.attachStacktrace)}}function ji(e,t={},n){if("function"!=typeof e)return e;try{const t=e.__sentry_wrapped__;if(t)return t;if(ie(e))return e}catch(o){return e}const r=function(...n){try{const r=n.map((e=>ji(e,t)));return e.handleEvent?e.handleEvent.apply(this,r):e.apply(this,r)}catch(r){throw setTimeout((()=>{})),Ue((e=>{e.addEventProcessor((e=>{const r=c({},e);return t.mechanism&&(ye(r,void 0),ve(r,t.mechanism)),r.extra=u(c({},r.extra),{arguments:Gt(n,3)}),r})),Bn(r)})),r}};try{for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])}catch(o){}se(r,e),oe(e,"__sentry_wrapped__",r);try{const t=Object.getOwnPropertyDescriptor(r,"name");(null==t?void 0:t.configurable)&&Object.defineProperty(r,"name",{get:()=>e.name})}catch(o){}return r}const Ni=class e{constructor(t){this.name=e.id,this._onErrorHandlerInstalled=!1,this._onUnhandledRejectionHandlerInstalled=!1,this._onPageNotFoundHandlerInstalled=!1,this._onMemoryWarningHandlerInstalled=!1,this._options=c({onerror:!0,onunhandledrejection:!0,onpagenotfound:!0,onmemorywarning:!0},t)}setupOnce(){Error.stackTraceLimit=50,this._options.onerror&&(O.log("Global Handler attached: onError"),this._installGlobalOnErrorHandler()),this._options.onunhandledrejection&&(O.log("Global Handler attached: onunhandledrejection"),this._installGlobalOnUnhandledRejectionHandler()),this._options.onpagenotfound&&(O.log("Global Handler attached: onPageNotFound"),this._installGlobalOnPageNotFoundHandler()),this._options.onmemorywarning&&(O.log("Global Handler attached: onMemoryWarning"),this._installGlobalOnMemoryWarningHandler())}_installGlobalOnErrorHandler(){this._onErrorHandlerInstalled||(Oi.onError&&Oi.onError((e=>{Bn("string"==typeof e?new Error(e):e)})),this._onErrorHandlerInstalled=!0)}_installGlobalOnUnhandledRejectionHandler(){this._onUnhandledRejectionHandlerInstalled||(Oi.onUnhandledRejection&&Oi.onUnhandledRejection((({reason:e,promise:t})=>{Bn("string"==typeof e?new Error(e):e,{data:t})})),this._onUnhandledRejectionHandlerInstalled=!0)}_installGlobalOnPageNotFoundHandler(){this._onPageNotFoundHandlerInstalled||(Oi.onPageNotFound&&Oi.onPageNotFound((e=>{const t=e.path.split("?")[0];Wn("pagenotfound",t),zn("message",JSON.stringify(e)),Jn(`: ${t}`)})),this._onPageNotFoundHandlerInstalled=!0)}_installGlobalOnMemoryWarningHandler(){this._onMemoryWarningHandlerInstalled||(Oi.onMemoryWarning&&Oi.onMemoryWarning((({level:e=-1})=>{let t="";switch(e){case 5:t="TRIM_MEMORY_RUNNING_MODERATE";break;case 10:t="TRIM_MEMORY_RUNNING_LOW";break;case 15:t="TRIM_MEMORY_RUNNING_CRITICAL";break;default:return}Wn("memory-warning",String(e)),zn("message",t),Jn("")})),this._onMemoryWarningHandlerInstalled=!0)}};Ni.id="GlobalHandlers";let Di=Ni;const Li=class e{constructor(){this._ignoreOnError=0,this.name=e.id}_wrapTimeFunction(e){return function(...t){const n=t[0];return t[0]=ji(n,{mechanism:{data:{function:qi(e)},handled:!0,type:"instrument"}}),e.apply(this,t)}}_wrapRAF(e){return function(t){return e(ji(t,{mechanism:{data:{function:"requestAnimationFrame",handler:qi(e)},handled:!0,type:"instrument"}}))}}_wrapEventTarget(e){const t=y,n=t[e]&&t[e].prototype;n&&n.hasOwnProperty&&n.hasOwnProperty("addEventListener")&&(re(n,"addEventListener",(function(t){return function(n,r,o){try{"function"==typeof r.handleEvent&&(r.handleEvent=ji(r.handleEvent.bind(r),{mechanism:{data:{function:"handleEvent",handler:qi(r),target:e},handled:!0,type:"instrument"}}))}catch(s){}return t.call(this,n,ji(r,{mechanism:{data:{function:"addEventListener",handler:qi(r),target:e},handled:!0,type:"instrument"}}),o)}})),re(n,"removeEventListener",(function(e){return function(t,n,r){let o=n;try{o=o&&(o.__sentry_wrapped__||o)}catch(s){}return e.call(this,t,o,r)}})))}setupOnce(){this._ignoreOnError=this._ignoreOnError;const e=y;re(e,"setTimeout",this._wrapTimeFunction.bind(this)),re(e,"setInterval",this._wrapTimeFunction.bind(this)),re(e,"requestAnimationFrame",this._wrapRAF.bind(this)),["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"].forEach(this._wrapEventTarget.bind(this))}};Li.id="TryCatch";let Fi=Li;function qi(e){try{return e&&e.name||"<anonymous>"}catch(t){return"<anonymous>"}}const Ui=class e{constructor(t={}){this.name=e.id,this._key=t.key||"cause",this._limit=t.limit||5}setupOnce(){Gn(((t,n)=>{const r=Be(),o=r&&r.getIntegrationByName(e.id);return o?o._handler(t,n):t}))}_handler(e,t){if(!(e.exception&&e.exception.values&&t&&t.originalException instanceof Error))return e;const n=this._walkErrorTree(t.originalException,this._key);return e.exception.values=[...n,...e.exception.values],e}_walkErrorTree(e,t,n=[]){if(!(e[t]instanceof Error)||n.length+1>=this._limit)return n;const r=vi(e[t]);return this._walkErrorTree(e[t],t,[r,...n])}};Ui.id="LinkedErrors";let Bi=Ui;const Ji=class e{constructor(){this.name=e.id}setupOnce(){Gn((t=>{const n=Be();if(n&&n.getIntegrationByName(e.id))try{const e=Oi.getSystemInfoSync(),{SDKVersion:n="0.0.0",batteryLevel:r,currentBattery:o,battery:s,brand:i,language:a,model:l,pixelRatio:p,platform:d,screenHeight:f,screenWidth:m,system:g,version:h,app:_,appName:y}=e,[v,b]=g.split(" "),S=u(c({},t.tags),{SDKVersion:n}),x=_||y||Ci||"app";return u(c({},t),{tags:S,contexts:u(c({},t.contexts),{device:{brand:i,battery_level:r||o||s,model:l,language:a,platform:d,screen_dpi:p,screen_height:f,screen_width:m},os:{name:v||g,version:b||g},browser:{name:x,version:h}})})}catch(r){console.warn(`sentry-miniapp get system info fail: ${r}`)}return t}))}};Ji.id="System";let zi=Ji;const Wi=class e{constructor(t){this.name=e.id,this._options=c({enable:!0},t)}setupOnce(){Gn((t=>{const n=Be();if(n&&n.getIntegrationByName(e.id)&&this._options.enable)try{const e=getCurrentPages().map((e=>({route:e.route,options:e.options})));return u(c({},t),{extra:u(c({},t.extra),{routers:e})})}catch(r){console.warn(`sentry-miniapp get router info fail: ${r}`)}return t}))}};Wi.id="Router";let Hi=Wi;const Gi=class e{constructor(){this.name=e.id}setupOnce(){Gn((t=>{const n=Be();if(n&&n.getIntegrationByName(e.id)&&"wechat"===Ci&&Oi.getLaunchOptionsSync){if(1129===Oi.getLaunchOptionsSync().scene)return null}return t}))}};Gi.id="IgnoreMpcrawlerErrors";let Ki=Gi;const Vi=Object.freeze(Object.defineProperty({__proto__:null,GlobalHandlers:Di,IgnoreMpcrawlerErrors:Ki,LinkedErrors:Bi,Router:Hi,System:zi,TryCatch:Fi},Symbol.toStringTag,{value:"Module"})),Yi=[Wr(),Jr(),new Fi,new Di,new Bi,new zi,new Hi,new Ki];const Zi=2147483647;function Xi(e){return"number"==typeof e&&isFinite(e)}function Qi(e){return e/1e3}function ea(e,t,n,r){const o=Et(e).start_timestamp;return o&&o>t&&"function"==typeof e.updateStartTime&&e.updateStartTime(t),yn(e,(()=>{const e=_n(c({startTime:t},r));return e&&e.end(n),e}))}class ta{constructor(e=!1){this._reportAllChanges=e,this._measurements={},this._performanceCursor=0}addPerformanceEntries(e,t={}){var n;const r=this._getPerformance();if(!r)return;const o=this._getMiniProgramTimeOrigin(r);if(!o)return;const s=Qi(o),{op:i,start_timestamp:a}=Et(e),c=(null==(n=r.getEntries)?void 0:n.call(r))||[];c.slice(this._performanceCursor).forEach((n=>{const r=Qi(n.startTime),o=Qi(Math.max(0,n.duration));if(!("navigation"===i&&a&&s+r<a||this._shouldIgnoreEntry(n,t)))switch(n.entryType){case"navigation":this._addNavigationSpans(e,n,s);break;case"render":this._addRenderSpan(e,n,r,o,s);break;case"script":this._addScriptSpan(e,n,r,o,s);break;case"loadPackage":this._addPackageSpan(e,n,r,o,s);break;case"resource":this._addResourceSpan(e,n,r,o,s,t.ignoreResourceSpans)}})),this._performanceCursor=Math.max(c.length-1,0),this._trackSystemInfo(e),"pageload"!==i&&"navigation"!==i||(e.setAttribute("performance.timeOrigin",s),Object.entries(this._measurements).forEach((([e,t])=>{cn(e,t.value,t.unit)}))),this._measurements={}}addPerformanceEntriesFromSpan(e){this.addPerformanceEntries(e),this._stopObserver()}startObserving(e,t={}){var n;const r=this._getPerformance();if(!r)return;const o=Et(e);this._timeOrigin=this._getTimeOrigin(r,o.start_timestamp),this._measurements={},this._performanceCursor=0,this._observer=null==(n=r.createObserver)?void 0:n.call(r,(n=>{var r;const o=(null==(r=null==n?void 0:n.getEntries)?void 0:r.call(n))||[],s=Et(e);void 0===s.timestamp?o.forEach((n=>this._handleEntry(e,n,s.start_timestamp,t))):this._stopObserver()})),this._observer&&this._observer.observe({entryTypes:["navigation","render","script","loadPackage","resource"]})}_getPerformance(){if(!Oi.getPerformance)return;const e=Oi.getPerformance();return e||void 0}_getMiniProgramTimeOrigin(e){if("number"==typeof e.timeOrigin)return e.timeOrigin;const t="function"==typeof e.now?e.now():void 0;return"number"==typeof t?Date.now()-t:void 0}_getTimeOrigin(e,t){const n=this._getMiniProgramTimeOrigin(e);return n?Qi(n):t}_shouldIgnoreEntry(e,t){const{ignorePerformanceEntryNames:n=[]}=t;return!!(n.length>0&&e.name)&&(r=e.name,n.some((e=>"string"==typeof e?r===e:e.test(r))));var r}_handleEntry(e,t,n,r={}){var o;const s=null!=(o=this._timeOrigin)?o:n,i=Qi(t.startTime),a=Qi(Math.max(0,t.duration));if(!this._shouldIgnoreEntry(t,r)){switch(t.entryType){case"navigation":this._addNavigationSpans(e,t,s);break;case"render":this._addRenderSpan(e,t,i,a,s);break;case"script":this._addScriptSpan(e,t,i,a,s);break;case"loadPackage":this._addPackageSpan(e,t,i,a,s);break;case"resource":this._addResourceSpan(e,t,i,a,s,r.ignoreResourceSpans)}this._recordMeasurements(t,n,s+i)}}_addNavigationSpans(e,t,n){const r=n+Qi(t.startTime),o=r+Qi(Math.max(0,t.duration)),s={[Ge]:"auto.ui.miniapp.metrics","performance.entry_type":t.entryType};t.path&&(s["navigation.path"]=t.path),t.referrerPath&&(s["navigation.referrer_path"]=t.referrerPath),Xi(t.viewLayerReadyTime)&&(s["navigation.view_layer_ready_time"]=t.viewLayerReadyTime),ea(e,r,o,{name:t.path||t.name||"navigation",op:"browser.navigation",attributes:s}),Xi(t.duration)&&!this._measurements["navigation.duration"]&&(this._measurements["navigation.duration"]={value:t.duration,unit:"millisecond"}),Xi(t.viewLayerReadyTime)&&(this._measurements["navigation.view_layer_ready"]={value:t.viewLayerReadyTime,unit:"millisecond"})}_addRenderSpan(e,t,n,r,o){const s=o+n,i=s+r,a={[Ge]:"auto.ui.miniapp.metrics","performance.entry_type":t.entryType};t.path&&(a["ui.component_path"]=t.path),Xi(t.viewLayerReadyTime)&&(a["ui.view_layer_ready_time"]=t.viewLayerReadyTime),Xi(t.firstRenderTime)&&(a["ui.first_render_time"]=t.firstRenderTime),ea(e,s,i,{name:t.path||t.name||"render",op:"ui.render",attributes:a}),Xi(t.firstRenderTime)&&(this._measurements["ui.first_render"]={value:t.firstRenderTime,unit:"millisecond"})}_addScriptSpan(e,t,n,r,o){const s=o+n,i=s+r,a={[Ge]:"auto.resource.miniapp.metrics","performance.entry_type":t.entryType};t.moduleName&&(a["code.filepath"]=t.moduleName),ea(e,s,i,{name:t.moduleName||t.name||"script",op:"script",attributes:a})}_addPackageSpan(e,t,n,r,o){const s=o+n,i=s+r,a={[Ge]:"auto.resource.miniapp.metrics","performance.entry_type":t.entryType};t.packageName&&(a["resource.package_name"]=t.packageName),Xi(t.packageSize)&&t.packageSize<Zi&&(a["resource.package_size"]=t.packageSize),ea(e,s,i,{name:t.packageName||t.name||"loadPackage",op:"resource.package",attributes:a})}_addResourceSpan(e,t,n,r,o,s){if("xmlhttprequest"===t.initiatorType||"fetch"===t.initiatorType)return;const i=t.initiatorType?`resource.${t.initiatorType}`:"resource.other";if(null==s?void 0:s.includes(i))return;const a=o+n,c=a+r,u={[Ge]:"auto.resource.miniapp.metrics","performance.entry_type":t.entryType};t.initiatorType&&(u["resource.initiator_type"]=t.initiatorType),Xi(t.transferSize)&&t.transferSize<Zi&&(u["http.response_transfer_size"]=t.transferSize),t.path&&(u["resource.path"]=t.path),ea(e,a,c,{name:t.path||t.name||"resource",op:i,attributes:u})}_trackSystemInfo(e){if(Oi.getSystemInfoSync)try{const t=Oi.getSystemInfoSync();if(!t)return;t.networkType&&e.setAttribute("network.type",t.networkType),t.platform&&e.setAttribute("device.platform",t.platform),t.model&&e.setAttribute("device.model",t.model),t.system&&e.setAttribute("os.version",t.system),Xi(t.benchmarkLevel)&&e.setAttribute("device.benchmark_level",String(t.benchmarkLevel))}catch(t){}}_recordMeasurements(e,t,n){const r=(e.name||"").toLowerCase(),o=e.duration,s=Math.max(1e3*(n-t),0);if("first-paint"===r||"firstpaint"===r?this._measurements.fp={value:s,unit:"millisecond"}:"first-contentful-paint"===r||"firstcontentfulpaint"===r?this._measurements.fcp={value:s,unit:"millisecond"}:"largest-contentful-paint"===r||"largestcontentfulpaint"===r||"lcp"===r?this._measurements.lcp={value:s,unit:"millisecond"}:"first-input-delay"!==r&&"firstinputdelay"!==r&&"fid"!==r||!Xi(o)||(this._measurements.fid={value:o,unit:"millisecond"}),Xi(e.viewLayerReadyTime)&&!this._measurements.view_layer_ready&&(this._measurements.view_layer_ready={value:e.viewLayerReadyTime,unit:"millisecond"}),Xi(e.firstRenderTime)&&!this._measurements.first_render&&(this._measurements.first_render={value:e.firstRenderTime,unit:"millisecond"}),this._reportAllChanges&&Xi(o)){const t=this._measurementKey(e);t&&!this._measurements[t]&&(this._measurements[t]={value:o,unit:"millisecond"})}}_measurementKey(e){const t=e.name||e.entryType;if(t)return t.replace(/\s+/g,"_").toLowerCase()}_stopObserver(){var e;null==(e=this._observer)||e.disconnect(),this._observer=void 0}}const na="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__;function ra(){const e=Pt(),t=e&&Mt(e);if(!t)return;const n=Et(t).op;return"navigation"===n||"pageload"===n?t:void 0}function oa(e){return{name:e.path||"unknown",source:"url"}}function sa(e,t){const n={[Ge]:t};return e.openType&&(n["miniapp.open_type"]=e.openType),void 0!==e.scene&&(n["miniapp.scene"]=e.scene),void 0!==e.isTabBar&&(n["miniapp.is_tabbar"]=e.isTabBar),void 0!==e.webviewId&&(n["miniapp.webview_id"]=e.webviewId),e.query&&(n["miniapp.query"]=e.query),n}function ia(e){return{path:(null==e?void 0:e.path)||(null==e?void 0:e.route)||(null==e?void 0:e.url)||"unknown-route",query:null==e?void 0:e.query,scene:null==e?void 0:e.scene,openType:null==e?void 0:e.openType,isTabBar:null==e?void 0:e.isTabBar,webviewId:null==e?void 0:e.webviewId,routeEventId:null==e?void 0:e.routeEventId,timeStamp:null==e?void 0:e.timeStamp}}function aa(e,t=!1){return"appLaunch"===e||!!t}function ca(e,t){const{instrumentPageLoad:n=!0,instrumentNavigation:r=!0,endSpanOnRouteComplete:o=!0}=e,s=y,i=Oi.onBeforeAppRoute,a=Oi.onAppRoute,c=Oi.onAppRouteDone,u=Oi.onBeforePageLoad,l=Oi.onAfterPageLoad,p="function"==typeof i;if(!p&&"function"!=typeof a)return void O.warn("[MiniAppTracing] No route event API available");let d=!0,f=!1;const m=new Map;if(n&&"function"==typeof s.getCurrentPages){const e=s.getCurrentPages()||[],n=e[e.length-1];if(null==n?void 0:n.route){f=!0,d=!1;ua({path:n.route,openType:"appLaunch"},t)}}p?(na&&O.log("[MiniAppTracing] Using new route event API (onBeforeAppRoute)"),i((e=>{const o=ia(e),s=o.routeEventId,i=o.timeStamp?o.timeStamp/1e3:ke();na&&O.log("[MiniAppTracing] onBeforeAppRoute:",o.path,"routeEventId:",s);const a=!f&&aa(o.openType,d);d&&(d=!1),a&&!n||!a&&!r||(s&&m.set(s,{route:o,startTime:i,isPageLoad:a}),a&&n?(f=!0,ua(o,t,i)):r&&f&&la(o,t,i))})),"function"==typeof a&&a((e=>{const t=ia(e),n=t.routeEventId,r=t.timeStamp?t.timeStamp/1e3:ke();na&&O.log("[MiniAppTracing] onAppRoute:",t.path,"routeEventId:",n);const s=ra();if(n){const e=m.get(n);if(e){const o=1e3*(r-e.startTime);s&&(s.setAttribute("miniapp.route_duration_ms",o),s.setAttribute("miniapp.route_event_id",n)),na&&O.log(`[MiniAppTracing] Route completed: ${t.path}, duration: ${o.toFixed(2)}ms`),m.delete(n)}}o&&s&&!Et(s).timestamp&&(s.setAttribute(Ke,"routeComplete"),s.end(r),na&&O.log(`[MiniAppTracing] Ended span on onAppRoute: ${t.path}`))})),"function"==typeof c&&c((e=>{na&&O.log("[MiniAppTracing] onAppRouteDone:",null==e?void 0:e.path)}))):(na&&O.log("[MiniAppTracing] Using legacy route event API (onAppRoute)"),a((e=>{const o=ia(e),s=!f&&aa(o.openType,d);if(d&&(d=!1),s&&n)return f=!0,void ua(o,t);r&&f&&la(o,t)})),"function"==typeof c&&c((e=>{na&&O.log("[MiniAppTracing] Route done:",null==e?void 0:e.path)}))),"function"==typeof u&&u((e=>{na&&O.log("[MiniAppTracing] onBeforePageLoad:",null==e?void 0:e.path)})),"function"==typeof l&&l((e=>{na&&O.log("[MiniAppTracing] onAfterPageLoad:",null==e?void 0:e.path)}))}function ua(e,t,n){const{name:r,source:o}=oa(e),s=sa(e,"auto.pageload.miniapp");s[ze]=o;const i=ra();if(i){"custom"!==(Et(i).data||{})[ze]&&(i.updateName(r),i.setAttribute(ze,o)),i.setAttributes(s),na&&O.log(`[MiniAppTracing] Updated pageload span: ${r}`)}else{Le().setTransactionName(r);const e={name:r,op:"pageload",attributes:s};void 0!==n&&(e.startTime=n),t(e),na&&O.log(`[MiniAppTracing] Created pageload span: ${r}${n?" (with accurate timing)":""}`)}}function la(e,t,n){const{name:r,source:o}=oa(e),s=sa(e,"auto.navigation.miniapp");s[ze]=o,Le().setTransactionName(r);const i={name:r,op:"navigation",attributes:s};void 0!==n&&(i.startTime=n),t(i),na&&O.log(`[MiniAppTracing] Created navigation span: ${r}${n?" (with accurate timing)":""}`)}let pa,da;function fa(){return pa||(pa={traceId:Te(),spanId:Ie(),sampleRand:Math.random()}),pa}const ma="_sentry_miniapp_idleSpan";function ga(e){return e[ma]}function ha(e,t){oe(e,ma,t)}const _a=c({idleTimeout:1e3,finalTimeout:3e4,childSpanTimeout:15e3,instrumentPageLoad:!0,instrumentNavigation:!0,endSpanOnRouteComplete:!0,traceContinuityMode:"link",consistentTraceSampling:!1},{traceRequest:!0});function ya(e,t,n){const{idleTimeout:r,finalTimeout:o,childSpanTimeout:s,traceContinuityMode:i,consistentTraceSampling:a,beforeStartSpan:l,metricsInstrumentation:p,performanceEntriesOptions:d,latestRoute:f}=n;!function(e){const t=ga(e);t&&!Et(t).timestamp&&(na&&O.log(`[MiniAppTracing] Finishing current active span with op: ${Et(t).op}`),t.setAttribute(Ke,"navigationStart"),t.end())}(e);const m=function(e,t){var n;if("off"===e){return void Le().setPropagationContext({traceId:Te(),sampleRand:Math.random()})}const r=da,o=!!da&&Date.now()/1e3-da.startTimestamp<=3600;if("session"===e){const e=fa();return Le().setPropagationContext(c({traceId:e.traceId,sampleRand:e.sampleRand},t&&o&&r&&{sampled:1===r.spanContext.traceFlags})),void(na&&O.log(`[MiniAppTracing] Session mode: reusing traceId=${e.traceId}`))}if("link"===e){const e=function(e=!1){return pa={traceId:e&&pa?pa.traceId:Te(),spanId:Ie(),sampleRand:Math.random()},pa}(!1);if(Le().setPropagationContext(c({traceId:e.traceId,sampleRand:e.sampleRand},t&&o&&r&&{sampled:1===r.spanContext.traceFlags})),o&&r)return na&&O.log(`[MiniAppTracing] Link mode: new traceId=${e.traceId}, linked from ${r.spanContext.traceId}`),[{context:{traceId:r.spanContext.traceId,spanId:r.spanContext.spanId,traceFlags:null!=(n=r.spanContext.traceFlags)?n:0},attributes:{"sentry.link.type":"previous_trace"}}]}return}(i,a),g=l?l(t):t;m&&m.length>0&&(g.links=[...g.links||[],...m]);const h=g.attributes||{};f.name=g.name,f.source=h[ze];const _=Tn(g,{idleTimeout:r,finalTimeout:o,childSpanTimeout:s,beforeSpanEnd:t=>{var n;null==p||p.addPerformanceEntries(t,d),ha(e,void 0);const r=Le(),o=r.getPropagationContext();r.setPropagationContext(u(c({},o),{traceId:t.spanContext().traceId,sampled:Tt(t),dsc:Wt(t)}));const s=Et(t);var i,a,l,f,m,g;i=t.spanContext().traceId,a=t.spanContext().spanId,l=Tt(t),f=s.start_timestamp,m=1,g=null!=(n=o.sampleRand)?n:Math.random(),da={spanContext:{traceId:i,spanId:a,traceFlags:l?1:0},startTimestamp:f,sampleRate:m,sampleRand:g},na&&O.log(`[MiniAppTracing] Span ended: ${s.op} - ${s.description}, traceId=${t.spanContext().traceId}`)}});return _.setAttribute("miniapp.trace_continuity_mode",i),ha(e,_),na&&O.log(`[MiniAppTracing] Started ${t.op} span: ${t.name}, traceId=${_.spanContext().traceId}`),_}exports.Integrations=Vi,exports.MiniappClient=Ri,exports.SDK_NAME=li,exports.SDK_VERSION=pi,exports.Transports=Mi,exports.addBreadcrumb=qr,exports.addEventProcessor=Gn,exports.captureConsoleIntegration=ro,exports.captureEvent=function(e,t){return Le().captureEvent(e,t)},exports.captureException=Bn,exports.captureMessage=Jn,exports.close=function(e){const t=Be();return t?t.close(e):In(!1)},exports.consoleLoggingIntegration=Do,exports.createConsolaReporter=function(e={}){var t;const n=new Set(null!=(t=e.levels)?t:qo),r=e.client;return{log(e){const t=e,{type:o,level:s,message:i,args:a,tag:c,date:u}=t,p=l(t,["type","level","message","args","tag","date"]),d=r||Be();if(!d)return;const f=function(e,t){if("verbose"===e)return"debug";if("silent"===e)return"trace";if(e){const t=Uo[e];if(t)return t}if("number"==typeof t){const e=Bo[t];if(e)return e}return"info"}(o,s);if(!n.has(f))return;const{normalizeDepth:m=3,normalizeMaxBreadth:g=1e3}=d.getOptions(),h=[];i&&h.push(i),a&&a.length>0&&h.push(jo(a,m,g));const _=h.join(" ");p["sentry.origin"]="auto.log.consola",c&&(p["consola.tag"]=c),o&&(p["consola.type"]=o),null!=s&&"number"==typeof s&&(p["consola.level"]=s),nr({level:f,message:_,attributes:p})}}},exports.defaultIntegrations=Yi,exports.extraErrorDataIntegration=oo,exports.featureFlagsIntegration=Mo,exports.flush=function(e){const t=Be();return t?t.flush(e):In(!1)},exports.getActiveMiniAppRootSpan=function(){return ra()},exports.getActiveMiniAppSpan=function(){const e=Be();return e?ga(e):void 0},exports.getActiveSpan=Pt,exports.getCurrentScope=Le,exports.getRootSpan=Mt,exports.getSpanDescendants=$t,exports.getSpanStatusFromHttpCode=et,exports.init=function(e={}){void 0===e.defaultIntegrations&&(e.defaultIntegrations=Yi),e.normalizeDepth=e.normalizeDepth||5;const t=c({integrations:e.integrations||e.defaultIntegrations||[],stackParser:e.stackParser||(()=>[]),transport:e.transport||$i},e);Nr(Ri,t)},exports.instrumentAnthropicAiClient=function(e,t){var n;const r=Boolean(null==(n=Be())?void 0:n.getOptions().sendDefaultPii);return ti(e,"",c({recordInputs:r,recordOutputs:r},t))},exports.instrumentGoogleGenAIClient=function(e,t){var n;const r=Boolean(null==(n=Be())?void 0:n.getOptions().sendDefaultPii);return ui(e,"",c({recordInputs:r,recordOutputs:r},t))},exports.instrumentMiniAppRouter=ca,exports.instrumentOpenAiClient=function(e,t){return Hs(e,"",t)},exports.instrumentSupabaseClient=xo,exports.lastEventId=function(){return Hn()},exports.logger=Ro,exports.makeMultiplexedTransport=function(e,t){return n=>{const r=e(n),o=new Map;function s(t,r){const s=r?`${t}:${r}`:t;let i=o.get(s);if(!i){const a=mt(t);if(!a)return;const l=Kn(a,n.tunnel);i=r?function(e,t){return n=>{const r=e(n);return u(c({},r),{send:e=>p(null,null,(function*(){const n=Dr(e,["event","transaction","profile","replay_event"]);return n&&(n.release=t),r.send(e)}))})}}(e,r)(u(c({},n),{url:l})):e(u(c({},n),{url:l})),o.set(s,i)}return[t,i]}return{send:function(e){return p(this,null,(function*(){const n=t({envelope:e,getEvent:function(t){const n=(null==t?void 0:t.length)?t:["event"];return Dr(e,n)}}).map((e=>"string"==typeof e?s(e,void 0):s(e.dsn,e.release))).filter((e=>!!e)),o=n.length?n:[["",r]],i=yield Promise.all(o.map((([t,n])=>n.send(function(e,t){return Yt(t?u(c({},e[0]),{dsn:t}):e[0],e[1])}(e,t)))));return i[0]}))},flush:function(e){return p(this,null,(function*(){const t=[...o.values(),r];return(yield Promise.all(t.map((t=>t.flush(e))))).every((e=>e))}))}}}},exports.metrics=Fo,exports.miniappTracingIntegration=function(e={}){const t=c(c({},_a),e),{idleTimeout:n,finalTimeout:r,childSpanTimeout:o,instrumentPageLoad:s,instrumentNavigation:i,endSpanOnRouteComplete:a,traceContinuityMode:u,consistentTraceSampling:l,beforeStartSpan:p,_metricOptions:d,ignoreResourceSpans:f,ignorePerformanceEntryNames:m}=t,g={ignoreResourceSpans:f,ignorePerformanceEntryNames:m};let h,_,y;return{name:"MiniAppTracing",setupOnce(){h=new ta(null==d?void 0:d._reportAllChanges)},setup(e){var t;null==(t=Oi.onAppHide)||t.call(Oi,(()=>{const t=ga(e);t&&!Et(t).timestamp&&(na&&O.log("[MiniAppTracing] App hiding, finishing active span"),t.setAttribute(Ke,"appHide"),t.end())}))},afterAllSetup(e){ca({instrumentPageLoad:s,instrumentNavigation:i,endSpanOnRouteComplete:a},(t=>{ya(e,t,{idleTimeout:n,finalTimeout:r,childSpanTimeout:o,traceContinuityMode:u,consistentTraceSampling:l,beforeStartSpan:p,metricsInstrumentation:h,performanceEntriesOptions:g,latestRoute:{get name(){return _},set name(e){_=e},get source(){return y},set source(e){y=e}}})}))}}},exports.moduleMetadataIntegration=Qr,exports.registerSpanErrorInstrumentation=function(){function e(){const e=Pt(),t=e&&Mt(e);if(t){const e="internal_error";_&&O.log(`[Tracing] Root span: ${e} -> Global error occurred`),t.setStatus({code:2,message:e})}}jt||(e.tag="sentry_tracingErrorCallback",jt=!0,function(e){const t="error";j(t,e),N(t,F)}(e),function(e){const t="unhandledrejection";j(t,e),N(t,U)}(e))},exports.rewriteFramesIntegration=lo,exports.setContext=function(e,t){Fe().setContext(e,t)},exports.setExtra=zn,exports.setExtras=function(e){Fe().setExtras(e)},exports.setHttpStatus=nt,exports.setMeasurement=cn,exports.setTag=Wn,exports.setTags=function(e){Fe().setTags(e)},exports.setUser=function(e){Fe().setUser(e)},exports.showReportDialog=function(e={}){e.eventId||(e.eventId=Hn());const t=Be();t&&t.showReportDialog(e)},exports.startInactiveSpan=_n,exports.startMiniAppTracingNavigationSpan=ya,exports.startNewTrace=function(e){return Ue((t=>(t.setPropagationContext({traceId:Te(),sampleRand:Math.random()}),_&&O.log(`Starting a new trace with id ${t.getPropagationContext().traceId}`),yn(null,e))))},exports.startSpan=gn,exports.startSpanManual=hn,exports.supabaseIntegration=ko,exports.thirdPartyErrorFilterIntegration=Ao,exports.withActiveSpan=yn,exports.withScope=Ue,exports.wrap=function(e){return ji(e)()},exports.zodErrorsIntegration=Io;
//# sourceMappingURL=index.cjs.map
